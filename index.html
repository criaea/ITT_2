<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personality Questionnaire</title>
    
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel&family=Comfortaa&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Basic Styles --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: #f0f4f9; 
            color: #333;
            line-height: 1.6;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            /* Padding/display removed, handled by container */
        }

        /* --- ADDED BACK --- */
        .container {
            max-width: 900px;
            width: 100%;
            margin: 20px auto; /* Added margin for spacing */ 
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
        }
        /* --- END ADDED BACK --- */

        /* --- REMOVED --- */
        /* @keyframes fadeIn ... */
        /* @keyframes fadeOut ... */
        /* .question-container.fade-out ... */

        /* --- MODIFIED --- */
        .question-container {
            margin-bottom: 25px;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            
            /* Replaced animation with transition */
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        }

        /* --- ADDED --- */
        .question-container.transitioning {
            opacity: 0;
            transform: translateY(-10px); /* Fades out by moving up */
        }
        /* --- END CHANGES --- */

        .question-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(37, 117, 252, 0.3);
            flex-shrink: 0;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.25rem;
            text-align: center;
            line-height: 1.5;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }
        
        .option {
            display: flex;
            align-items: center;
            justify-content: center; /* Center text */
            text-align: center; /* Center text */
            padding: 20px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: rgba(248, 249, 250, 0.8);
            min-height: 80px; /* Ensure options have same height */
        }
        
        .option:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-color: #a0b4c8;
        }
        
        .option.selected {
            background-color: #e3f2fd;
            border-color: #2575fc;
            box-shadow: 0 8px 25px rgba(37, 117, 252, 0.2);
            transform: translateY(-4px);
            color: #2575fc; /* Change text color when selected */
            font-weight: 600; /* Make text bold when selected */
        }
        
        .option input {
            display: none; /* Hide the radio button */
        }
        
        /* --- Navigation Styles --- */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        
        button {
            padding: 12px 28px;
            background: linear-gradient(145deg, #5a29e4, #3a68d8);
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 
                        inset 0 1px 1px rgba(255, 255, 255, 0.2);
            text-shadow: 0 -1px 0 rgba(0,0,0,0.2);
            white-space: nowrap;
        }
        
        button:hover {
            background: linear-gradient(145deg, #6b3ef0, #4c7ce0);
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 
                        0 3px 6px rgba(0, 0, 0, 0.08),
                        inset 0 1px 1px rgba(255, 255, 255, 0.2);
        }

        button:active {
            transform: translateY(1px);
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 
                        inset 0 2px 3px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            color: #7f8c8d;
            text-shadow: none;
        }

        /* --- Cover Page Styles --- */
        #coverPage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center vertically */
            text-align: center;
            
            /* REMOVED: position: fixed; and other overlay styles */
            
            padding: 20px 0; /* Add some vertical padding */
            /* REMOVED: transition, visibility, opacity */
        }
        
        /* REMOVED: #coverPage.hidden rule */

        #coverImage {
            max-width: 450px; /* Constrained max width */
            width: 80%; /* Responsive width */
            height: auto;
            /* border-radius: 10px; */ /* REMOVED per request */
            margin-bottom: 30px;
            /* box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15); */ /* REMOVED per request */
        }

        /* Title style from index.html */
        #coverTitle.cover-title {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 400;
            margin-bottom: 30px; /* Increased space */
            letter-spacing: 1px;
            color: #2c3e50;
        }
        
        /* Logo style from index.html */
        #coverTitle .itt-logo {
            font-family: 'Comfortaa', cursive;
            font-weight: 400; 
            font-size: 1.0em; /* Relative to the h1 */
            vertical-align: middle; 
        }

        /* Restored original button style from index.html */
        #startBtn {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 15px 40px;
            border-radius: 50px; /* Original style */
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); /* Original style */
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(37, 117, 252, 0.3);
            margin-top: 30px;
        }
        
        #startBtn:hover {
            transform: translateY(-3px) scale(1.05); /* Original style */
            box-shadow: 0 8px 25px rgba(37, 117, 252, 0.4);
        }


        /* --- Results Page Styles --- */
        #resultsPage {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-in-out;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            max-width: 600px; /* Constrain chart width */
            margin: 0 auto;
        }
        
        .personality-type-display {
            font-size: 3.5rem; /* Big text */
            font-weight: 700; /* Bold */
            color: #2c3e50; /* Dark blue-grey */
            text-align: center; /* Centered */
            margin-top: 25px; /* Space below the chart */
            letter-spacing: 2px; /* A bit of spacing */
        }

        .personality-words-display {
            font-size: 1.25rem;
            /* color: #34495e; */ /* OLD */
            color: #2c3e50; /* NEW */
            text-align: center;
            /* margin-top: 10px; */ /* OLD */
            letter-spacing: 1px;
            font-weight: 600; /* NEW */
            padding: 18px 25px; /* NEW */
            border-bottom: 1px solid #e0e6ed; /* NEW */
        }
        
        .personality-words-display strong {
             /* color: #2c3e50; Make the bold letter a bit darker */
             color: #2575fc; /* Use main accent blue */
             font-size: 1.1em; /* Make it slightly larger */
             font-weight: 700; /* Ensure it's bold */
        }

        .restart-button-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        /* --- NEW: Style for the toggle button --- */
        .toggle-other-container {
            display: flex;
            justify-content: center;
            margin-top: 25px;
            margin-bottom: 25px;
        }

        .other-toggle-btn {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            padding: 12px 30px;
            border-radius: 50px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border: 2px solid #a881ef;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px #a881ef, 0 0 20px #a881ef, inset 0 0 5px rgba(255, 255, 255, 0.2);
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.4);
        }
        
        .other-toggle-btn:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 0 15px #a881ef, 0 0 30px #a881ef, inset 0 0 5px rgba(255, 255, 255, 0.3);
        }
        /* --- END NEW --- */

        /* --- ADDED: Letter Definition Grid Styles --- */
        .letter-definitions-grid {
            display: grid;
            grid-template-columns: 1fr; /* CHANGED: Was 1fr 1fr */
            gap: 20px;
            margin: 30px 0;
            display: none; /* Hidden by default, shown by JS */
        }

        .letter-card {
            background: #fff;
            border-radius: 10px;
            /* padding: 20px; */ /* REMOVED padding from main element */
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-top: 5px solid #ccc; /* Default border, color set by JS */
            transition: all 0.3s ease;
            overflow: hidden; /* ADDED */
        }

        .letter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }

        .letter-card-title {
            font-weight: 700;
            font-size: 1.25rem;
            color: #2c3e50;
            margin-bottom: 0; /* CHANGED */
            padding: 20px; /* ADDED */
            padding-right: 50px; /* ADDED for icon */
            cursor: pointer; /* ADDED */
            position: relative; /* ADDED */
            list-style: none; /* ADDED */
        }
        
        /* ADDED: Hide default marker */
        .letter-card-title::-webkit-details-marker {
            display: none;
        }

        /* ADDED: Custom arrow for letter card */
        .letter-card-title::after {
            content: '+';
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem; /* Smaller than other sections */
            font-weight: 300;
            color: #2575fc;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.2s ease;
        }

        .letter-card[open] > .letter-card-title::after {
            content: '−';
            transform: translateY(-50%) rotate(180deg);
        }
        /* --- END ADDED --- */

        .letter-card-desc {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #34495e;
            padding: 0 20px 20px 20px; /* ADDED padding */
        }
        /* --- END ADDED STYLES --- */


        /* --- REMOVED: Styles for static Overview title --- */
        /*
        .result-section-static {
            ...
        }
        
        .other-letter-card .letter-card-title {
            font-weight: 500;
            color: #555;
        }
        /* --- END ADDED STYLES --- */


        /* --- ADDED: Result Details Section Styles --- */
        .results-details {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e0e6ed;
        }

        /* --- MODIFIED: For <details> accordion --- */
        .result-section {
            margin-bottom: 15px; /* Switched to details */
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #e0e6ed;
            overflow: hidden; /* For clean radius */
        }

        .result-section[open] {
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }

        .result-section-title {
            font-size: 1.25rem; /* Made slightly smaller */
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0; /* Handled by padding */
            padding: 18px 25px;
            border-bottom: none; /* Removed border */
            display: block; /* Make summary full width */
            cursor: pointer;
            position: relative;
            list-style: none; /* Remove default marker */
        }

        .result-section-title::-webkit-details-marker {
            display: none; /* Hide for Chrome/Safari */
        }

        /* Custom Accordion Arrow */
        .result-section-title::after {
            content: '+';
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 300;
            color: #2575fc;
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.2s ease;
        }

        .result-section[open] > .result-section-title::after {
            content: '−'; /* Minus sign */
            transform: translateY(-50%) rotate(180deg);
        }

        .result-section-content {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #34495e;
            /* padding: 0 25px 25px 25px; */ /* OLD */
            padding: 25px; /* NEW */
        }

        /* Style for the main overview paragraph */
        #desc-overview {
            font-style: italic;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .placeholder {
            color: #7f8c8d;
            font-style: italic;
        }
        /* --- END ADDED STYLES --- */
        
        /* --- Mobile Optimizations --- */
        @media (max-width: 768px) {
            body { 
                padding: 0; 
                display: block; /* Allow natural flow on mobile */
            }
            .container {
                border-radius: 0;
                padding: 20px;
                min-height: 100vh;
                width: 100%;
                margin: 0; /* Full width on mobile */
            }
            .navigation { 
                flex-direction: column; 
                gap: 15px; 
            }
            
            .dev-navigation {
                order: -1; /* Move dev button to top on mobile */
                width: 100%;
            }
            
            .dev-navigation button {
                width: 100%;
            }
            
            .navigation button {
                width: 100%; /* Make buttons full width */
            }
            
            .options-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            /* --- ADDED: Mobile grid --- */
            .letter-definitions-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.5rem;
            }
            .question-text {
                font-size: 1.1rem;
            }
            
            .personality-type-display {
                font-size: 2.5rem; /* A bit smaller on mobile */
                margin-top: 20px;
            }

            .personality-words-display {
                font-size: 1rem;
            }

            #coverImage {
                max-width: 95%; /* Make image take more width on small screens */
                margin-bottom: 20px;
            }
            
            #coverTitle.cover-title {
                font-size: 2rem;
            }
            #startBtn {
                padding: 12px 30px;
                font-size: 1rem;
            }
        }

    </style>
</head>
<body>
    
    <!-- MOVED: Cover Page is now INSIDE the container -->
    <!-- REMOVED: style="display: none;" from container -->
    <div class="container">
        
        <div id="coverPage">
            <h1 id="coverTitle" class="cover-title"><span class="itt-logo">2 ITT</span> (Innate taste test)</h1>
            <img id="coverImage" src="2heads.jpg" alt="Two stylized heads communicating with satellite dishes">
             <button id="startBtn">Begin the Evaluation</button>
        </div>

        <!-- ADDED: style="display: none;" to hide container initially -->
        <!-- Quiz Section -->
        <div id="quizSection" style="display: none;"> <!-- Hidden by default, shown after cover -->
            <h1>Personality Questionnaire</h1>
            
            <!-- --- MODIFIED: Content is now static --- -->
            <div id="questionnaire">
                <div class="question-container" id="q-container" style="opacity: 0;"> <!-- Start hidden -->
                    <div class="question-number" id="q-number">1</div>
                    <div class="question-text" id="q-text">Loading...</div>
                    <div class="options-container">
                        <div class="option" id="q-option-0" data-value="">
                            <input type="radio" name="q_radio" id="option0" value="">
                            <label for="option0" id="q-label-0">Option A</label>
                        </div>
                        <div class="option" id="q-option-1" data-value="">
                            <input type="radio" name="q_radio" id="option1" value="">
                            <label for="option1" id="q-label-1">Option B</label>
                        </div>
                    </div>
                </div>
            </div>
            <!-- --- END MODIFIED --- -->
            
            <!-- Dev Button -->
            <div class="dev-navigation" style="text-align: right; margin-bottom: 10px; margin-top: 15px;">
                <button id="randomBtn" style="background: #f39c12; border-color: #f39c12;">Dev: Random Results</button>
            </div>

            <div class="navigation" id="mainNavigation">
                <button id="prevBtn">Previous</button>
                <button id="nextBtn" style="display: none;">Next</button>
                <button id="finishBtn" style="display: none;">Finish</button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div id="resultsPage" style="display: none;">
            <h1>Your Results</h1>
            <div class="chart-container">
                <canvas id="resultsChart"></canvas>
            </div>
            
            <div id="personalityType" class="personality-type-display"></div> 
            <!-- MOVED: <div id="personalityWords" class="personality-words-display"></div> -->

            <!-- --- ADDED: Static Overview Section (MOVED) --- -->
            <div class="result-section-static">
                <!-- REMOVED: <h2 class="result-section-title-static">Overview</h2> -->
                <div id="personalityWords" class="personality-words-display"></div> <!-- MOVED HERE -->
                <p id="desc-overview" class="result-section-content"></p>
            </div>
            <!-- --- END ADDED --- -->

            <!-- --- ADDED: Letter Definitions Grid --- -->
            <div class="letter-definitions-grid" id="letter-grid">
                <!-- MODIFIED: Changed from <div> to <details> -->
                <details class="letter-card" id="letter-card-0">
                    <summary class="letter-card-title" id="letter-title-0"></summary>
                    <p class="letter-card-desc" id="letter-desc-0"></p>
                </details>
                <details class="letter-card" id="letter-card-1">
                    <summary class="letter-card-title" id="letter-title-1"></summary>
                    <p class="letter-card-desc" id="letter-desc-1"></p>
                </details>
                <details class="letter-card" id="letter-card-2">
                    <summary class="letter-card-title" id="letter-title-2"></summary>
                    <p class="letter-card-desc" id="letter-desc-2"></p>
                </details>
                <details class="letter-card" id="letter-card-3">
                    <!-- 
                      FIX: Added a space between class="letter-card-title" and id="letter-title-3"
                      This was the cause of the bug.
                    -->
                    <summary class="letter-card-title" id="letter-title-3"></summary>
                    <p class="letter-card-desc" id="letter-desc-3"></p>
                </details>
                <!-- --- END MODIFIED --- -->
            </div>
            <!-- --- END ADDED --- -->

            <!-- --- MODIFIED: Results Details Section (now an accordion) --- -->
            <div class="results-details">
                <!-- Section 1: Overview -->
                <!-- MOVED ABOVE LETTER GRID -->

                <!-- Section 2: Partner -->
                <details class="result-section">
                    <summary id="title-partner" class="result-section-title">As a Partner</summary>
                    <p class="result-section-content placeholder">Content coming soon...</p>
                </details>

                <!-- Section 3: Workplace -->
                <details class="result-section">
                    <summary id="title-workplace" class="result-section-title">In the Workplace</summary>
                    <p class="result-section-content placeholder">Content coming soon...</p>
                </details>

                <!-- Section 4: Leader -->
                <details class="result-section">
                    <summary id="title-leader" class="result-section-title">As a Leader</summary>
                    <p class="result-section-content placeholder">Content coming soon...</p>
                </details>
            </div>
            <!-- --- END MODIFIED --- -->

            <!-- --- NEW: Toggle button for other letters --- -->
            <div class="toggle-other-container">
                <button id="showOtherBtn" class="other-toggle-btn">Show Opposite Types</button>
            </div>
            <!-- --- END NEW --- -->

            <!-- --- NEW: Grid for other letters (hidden by default) --- -->
            <div class="letter-definitions-grid other-letter-grid" id="other-letter-grid">
                <details class="letter-card other-letter-card" id="other-letter-card-0">
                    <summary class="letter-card-title" id="other-letter-title-0"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-0"></p>
                </details>
                <details class="letter-card other-letter-card" id="other-letter-card-1">
                    <summary class="letter-card-title" id="other-letter-title-1"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-1"></p>
                </details>
                <details class="letter-card other-letter-card" id="other-letter-card-2">
                    <summary class="letter-card-title" id="other-letter-title-2"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-2"></p>
                </details>
                <details class="letter-card other-letter-card" id="other-letter-card-3">
                    <summary class="letter-card-title" id="other-letter-title-3"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-3"></p>
                </details>
            </div>
            <!-- --- END NEW --- -->

            <div class="restart-button-container">
                 <button id="restartBtn">Take Again</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Questions Data ---
            const questions = [
                { type: "S/N", text: "Are you", options: ["observant of your surroundings", "introspective and thinking"] },
                { type: "E/I", text: "Waiting for the train, do you?", options: ["chat to others", "stay silent"] },
                { type: "T/F", text: "When dealing with people are you?", options: ["Direct", "gentle"] },
                { type: "J/P", text: "Does workplace clutter?", options: ["stress you", "are you indifferent"] },
                { type: "T/F", text: "Which is easier for you to give?", options: ["critical/direct feedback", "avoid the vital details"] },
                { type: "S/N", text: "Do you?", options: ["Keep to the tried and trusted", "speculate about possibilities"] },
                { type: "J/P", text: "Do you?", options: ["decide instantaneously", "linger over decision making"] },
                { type: "S/N", text: "Are you?", options: ["factual", "imaginative"] },
                { type: "E/I", text: "When the phone rings do you?", options: ["rush to it", "leave others get it"] },
                { type: "T/F", text: "Do you place importance on?", options: ["hard data", "opinion"] },
                { type: "J/P", text: "Do you prefer agreements to?", options: ["be written up and signed", "agreed on word and a handshake"] },
                { type: "T/F", text: "When evaluating others are you?", options: ["impersonal and objective", "subjective and personal"] },
                { type: "S/N", text: "Are you more interested in?", options: ["what is real", "what is possible"] },
                { type: "J/P", text: "Are you more at ease?", options: ["When matters are complete", "with work in progress"] },
                { type: "S/N", text: "Are you always", options: ["Up to date with the news", "some what out of touch"] },
                { type: "E/I", text: "When socialising do you?", options: ["speak with many people", "a few friends"] },
                { type: "T/F", text: "When you are communicating with others do you?", options: ["talk directly", "talk diplomatically"] },
                { type: "J/P", text: "Do you prefer?", options: ["a detailed outline of work done", "a list of completed tasks"] },
                { type: "T/F", text: "Do you prefer?", options: ["A rational consistent approach", "harmonious personal approach"] },
                { type: "S/N", text: "Do you like authors who?", options: ["write hard facts", "use metaphors"] },
                { type: "J/P", text: "Are you more comfortable?", options: ["after a decision", "before a decision"] },
                { type: "S/N", text: "Are visionaries?", options: ["annoying", "fascinating"] },
                { type: "E/I", text: "Does being at a party?", options: ["energise you", "drain you"] },
                { type: "T/F", text: "In an argument/discussion do you?", options: ["act confrontational", "do you seek collaborative solutions"] },
                { type: "J/P", text: "For you is giving feedback?", options: ["easy", "difficult"] },
                { type: "T/F", text: "Which is preferable for you?", options: ["to be just", "to be understanding"] },
                { type: "S/N", text: "‘’Common sense’’ is?", options: ["usually reliable", "occasionally questionable"] },
                { type: "J/P", text: "Do you?", options: ["do one job at a time", "work at many jobs simultaneously"] },
                { type: "S/N", text: "Do you say?", options: ["what is on your mind", "express many opinions"] },
                { type: "E/I", text: "In a group of people do you?", options: ["talk a lot", "listen mostly"] },
                { type: "T/F", text: "Which sums you up best?", options: ["cool headed", "warm hearted"] },
                { type: "J/P", text: "Are you?", options: ["organised", "spontaneous"] },
                { type: "T/F", text: "In work situations do you?", options: ["give orders", "get everyone to find solutions"] },
                { type: "S/N", text: "Do you prefer?", options: ["sensible /factual people", "people who explore options"] },
                { type: "J/P", text: "Do you prefer to?", options: ["work to deadlines", "work whenever"] },
                { type: "S/N", text: "Which do you consider best?", options: ["ability to follow a plan", "adapt and adjust plans"] },
                { type: "E/I", text: "Are you?", options: ["a social person", "a private person"] },
                { type: "T/F", text: "Which are you?", options: ["a logical person", "a feeling person"] },
                { type: "J/P", text: "Do you decide?", options: ["based on analysis", "on a considered hunch"] },
                { type: "T/F", text: "Which is most satisfying for you?", options: ["thorough discussion", "reaching agreement"] },
                { type: "S/N", text: "After a meal do you?", options: ["tidy up immediately", "leave it until later"] },
                { type: "J/P", text: "Does your behaviour be?", options: ["hurried", "laid back"] },
                { type: "S/N", text: "Do you hear what is said as?", options: ["all the story", "most of the story"] },
                { type: "E/I", text: "Do you?", options: ["share your feelings easily", "act reserved"] },
                { type: "T/F", text: "Are you?", options: ["an uncompromising person", "a collaborative person"] },
                { type: "J/P", text: "Do you find it?", options: ["is stressful to change", "easy to reschedule meetings"] },
                { type: "T/F", text: "Are you?", options: ["tough minded", "fair minded"] },
                { type: "S/N", text: "When evaluating a situation do you", options: ["see only what is in front of you", "can you imagine more possibilities"] },
                { type: "J/P", text: "Is your approach?", options: ["ensure everything is arranged", "just let things happen"] },
                { type: "S/N", text: "Do you only trust?", options: ["past experiences", "all possibilities are worth checking"] },
                { type: "E/I", text: "Do you?", options: ["know a little about everything", "know much about a few things"] },
                { type: "T/F", text: "Are you convinced, more often, by?", options: ["hard evidence", "possible outside the box solutions"] },
                { type: "J/P", text: "Is your approach to life?", options: ["structure", "flexible"] },
                { type: "T/F", text: "Which is the greatest asset?", options: ["strength of will", "strength of fair compassion"] },
                { type: "S/N", text: "Do you always feel?", options: ["down to earth", "day dream a little"] },
                { type: "J/P", text: "How do you cope with unexpected events?", options: ["get a good handle on things", "get very stressed"] },
                { type: "S/N", text: "Do you act in?", options: ["Routine way", "whimsical way"] },
                { type: "E/I", text: "Are you?", options: ["a good conversationalist", "a good listener"] },
                { type: "T/F", text: "Are you?", options: ["tough skinned", "sensitive"] },
                { type: "J/P", text: "Do you tend to?", options: ["rely on old ways of doing", "be on the look out for new ways"] },
                { type: "T/F", text: "Do you prefer to?", options: ["operate the production machine", "manage the team of people"] },
                { type: "S/N", text: "Are you more?", options: ["practical", "ingenious"] }, // <-- THIS WAS THE BUG (type:D)
                { type: "J/P", text: "Are you?", options: ["more punctual", "leisurely /nonchalant"] },
                { type: "S/N", text: "Do you approach work in?", options: ["an organised and principaled way", "in an innovative and flexible way"] },
                { type: "E/I", text: "Are you?", options: ["social and outgoing", "reserved and quite"] },
                { type: "T/F", text: "Do you most trust?", options: ["your experience", "your hunches"] },
                { type: "J/P", text: "Do you", options: ["are always on the go", "relax, easy going"] },
                { type: "T/F", text: "Which is the greatest error?", options: ["being too passionate", "being too objective"] },
                { type: "S/N", text: "Do you tend to be more?", options: ["More deliberate", "more spontaneous"] },
                { type: "J/P", text: "In evaluating others what influences you most?", options: ["laws", "circumstances"] },
                { type: "S/N", text: "Which do you prefer in stories/film?", options: ["action", "fantasy"] },
                { type: "E/I", text: "In your sports club do you?", options: ["promote activities", "do you do the administration"] },
                { type: "T/F", text: "Which is more difficult for you to?", options: ["to identify with others", "to utilise others"] },
                { type: "J/P", text: "Are you?", options: ["a deadlines person", "a just whenever person"] },
                { type: "T/F", text: "Which is most vital?", options: ["following the to do list", "teamwork"] },
                { type: "S/N", text: "Are you?", options: ["easy to talk to/approach", "shy and reserved"] },
                { type: "J/P", text: "When do you plan your annual holidays?", options: ["months before", "weeks before"] },
                { type: "S/N", text: "Are you attracted to?", options: ["the fundamentals", "the promise"] },
                { type: "T/F", text: "For you which is more important?", options: ["follow the rules", "everyone take full responsibility"] },
                { type: "J/P", text: "Do you use?", options: ["written work schedules", "rely on my memory"] }
            ];

            const wordMap = {
                'E': 'Extroverted',
                'I': 'Introverted',
                'S': 'Sensate',
                'N': 'iNtuitive',
                'T': 'Thinking',
                'F': 'Feeling',
                'J': 'Judging',
                'P': 'Perceiving'
            };

            // --- ADDED: Letter Descriptions ---
            const letterDescriptions = {
                'E': `The extrovert seeks life in the outer world, drawing energy through engagement and relationships. Yet meaning is not found in activity alone; it emerges when outward action serves a higher purpose, transforming social connection into authentic participation in life.`,
                'I': `The introvert turns inward, seeking understanding through reflection and solitude. True fulfillment arises not from isolation, but from using inner insight to guide purposeful engagement with the world, allowing self-knowledge to become a tool for meaningful contribution.`,
                'S': `The sensate perceives life through the immediate, tangible world, valuing what can be observed and experienced. Meaning is discovered when attention to reality deepens awareness, transforming simple perception into conscious appreciation and purposeful interaction with life’s concrete elements.`,
                'N': `The intuitive perceives possibilities beyond the present, sensing patterns and potential outcomes. Yet insight alone is insufficient. Meaning emerges when intuition is applied to purposeful action, translating foresight into responsible choices that contribute to something greater than oneself.`,
                'T': `The thinking type relies on reason and logic to navigate life, seeking clarity and coherence. Yet intellect becomes meaningful only when aligned with conscience, guiding decisions toward responsibility, contribution, and the affirmation of values that transcend self-interest.`,
                'F': `The feeling type experiences life through empathy, values, and emotional resonance. Meaning is realized when compassion transforms into deliberate action, allowing emotion to guide purposeful engagement, and ensuring that care for others coexists with responsibility to self and life.`,
                'J': `The judging orientation seeks structure, order, and decisive action. Yet control is not purpose. True meaning arises when disciplined decisions serve a higher calling, allowing judgment to become an instrument for responsible living rather than an escape from uncertainty.`,
                'P': `The perceiving type values openness, flexibility, and responsiveness to life’s unfolding. Meaning is not found in freedom alone but in conscious engagement—choosing how to respond, embracing opportunity responsibly, and allowing curiosity to become directed action in service of life’s purpose.`
            };

            // --- ADDED: Personality Descriptions ---
            const personalityDescriptions = {
                'ISTJ': `Order brings safety. The ISTJ moves through life with steady hands and quiet conviction, upholding what is proven and true. Responsibility is their silent creed. Yet, beneath their reliability, there often lies an unspoken yearning—to be valued not only for their dependability, but for the tenderness they rarely allow the world to see.`,
                'ISFJ': `The ISFJ gives with quiet devotion, creating sanctuary in a world that seldom pauses. Their strength hides in humility; their love, in service. They tend to others’ needs instinctively, often forgetting their own. Behind their care lies a soul that longs to be cared for with the same gentleness they so effortlessly extend.`,
                'INFJ': `INFJs perceive life through symbols and meanings others miss. Their intuition weaves threads of empathy into vision. They sense human pain as though it were their own, often sacrificing themselves in the process. Beneath their serene composure lies a deep ache—to reconcile their inner truth with a world that too often fears its depth.`,
                'INTJ': `INTJs see life as a system to be understood, a puzzle to be elegantly resolved. Their insight cuts through illusion to essence. Purpose fuels them, solitude restores them. Yet, behind their precision lies an unspoken tenderness—the wish that the world might value understanding not as control, but as love expressed through clarity.`,
                'ISTP': `The ISTP moves fluidly between logic and action. They learn by doing, finding truth in direct experience. Detached calm steadies them amid chaos. Yet the same self-reliance that grants mastery can conceal a hidden solitude—a quiet uncertainty about belonging in a world that prizes words more than the language of doing.`,
                'ISFP': `ISFPs live through feeling and sensation, attuned to beauty, authenticity, and the sacredness of the moment. They seek harmony, not attention. Their gentleness often masks profound courage—the courage to live truthfully, even when unseen. Beneath their calm artistry rests a silent question: can the world honor softness as strength?`,
                'INFP': `INFPs live guided by inner values, drawn to what could be rather than what is. They see beauty in imperfection, hope in despair. Yet their idealism can isolate them—when the outer world cannot match their inner vision. Still, within them burns the timeless faith that authenticity itself can heal what is broken.`,
                'INTP': `The INTP seeks truth beyond appearance, ideas beyond convention. Their mind is a restless explorer, weaving patterns of thought where others see chaos. Detached yet deeply curious, they love clarity more than comfort. And beneath that intellectual distance, there lives a quiet longing—to feel at home in a world that rarely feels logical.`,
                'ESTP': `ESTPs meet life head-on—fast, fearless, alive. The present moment is their arena, risk their language. They thrive on movement, challenge, and immediacy. Yet their confidence can mask a deeper vulnerability: the fear of stillness, where action gives way to self-reflection. Beneath the thrill lies a human heart longing simply to rest.`,
                'ESFP': `ESFPs radiate vitality, sensing life through color, laughter, and touch. They live for connection, sharing energy like sunlight. Their spontaneity is medicine for the weary. Yet when the lights dim, they may feel the quiet ache of invisibility—the longing to be cherished not for their brightness, but for their unguarded truth.`,
                'ENFP': `ENFPs are guided by vision and possibility, moved by causes that ignite their hearts. They love deeply, dream vividly, and rebel against conformity. Yet their passion can scatter, their fire dimmed by overwhelm. Beneath their enthusiasm lies a quiet yearning—to find grounding without losing the wonder that makes them who they are.`,
                'ENTP': `ENTPs thrive on challenge and change, sparking ideas that disrupt stagnation. Their intellect dances with paradox and possibility. They question not to dominate, but to awaken. Yet their brilliance can conceal loneliness—the pain of being understood only for their wit, not their warmth. Beneath the debate lies a heart craving genuine connection.`,
                'ESTJ': `The ESTJ finds security in structure and progress in order. They lead by clarity, protect by discipline. Reliability is their language of love. Yet, in their pursuit of control, they may forget the gentleness that nurtures trust. Beneath the surface of certainty, there often lives a child yearning simply to be accepted without achievement.`,
                'ESFJ': `ESFJs create belonging wherever they go. Attuned to harmony, they nurture connection through care, tradition, and consistency. Their giving is sincere, yet exhausting when unreciprocated. Beneath their composure lies an unspoken plea—to be loved not only for their helpfulness, but for the quiet, unguarded self they so rarely reveal.`,
                'ENFJ': `ENFJs sense emotion like weather, responding with instinctive empathy. They uplift others through warmth and vision. Their gift is connection; their wound, self-neglect. In their quest to inspire, they may lose touch with their own needs. Yet when they remember to include themselves in their compassion, they become healers in motion.`,
                'ENTJ': `ENTJs lead with purpose and precision, turning ideas into structure and vision into strategy. They see potential where others see limits. Yet their drive can isolate them—control masking vulnerability, ambition hiding tenderness. When they allow softness alongside strength, they reveal not dominance, but deep devotion to creating a world that works.`
            };
            // --- END ADDED ---

            // --- App State ---
            let currentQuestionIndex = 0;
            let userAnswers = new Array(questions.length).fill(null);
            let resultsChartInstance = null;
            let isAdvancing = false; 

            // --- DOM Elements ---
            const coverPage = document.getElementById('coverPage');
            const startBtn = document.getElementById('startBtn');
            const quizContainer = document.querySelector('.container'); // Get container
            const quizSection = document.getElementById('quizSection');
            const questionnaireEl = document.getElementById('questionnaire');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');
            const resultsPage = document.getElementById('resultsPage');
            const restartBtn = document.getElementById('restartBtn');
            const randomBtn = document.getElementById('randomBtn'); 
            const personalityTypeEl = document.getElementById('personalityType'); 
            const personalityWordsEl = document.getElementById('personalityWords'); 

            // --- ADDED: Static element references ---
            const qContainer = document.getElementById('q-container');
            const qNumber = document.getElementById('q-number');
            const qText = document.getElementById('q-text');
            const qOption0 = document.getElementById('q-option-0');
            const qOption1 = document.getElementById('q-option-1');
            const qLabel0 = document.getElementById('q-label-0');
            const qLabel1 = document.getElementById('q-label-1');
            const qRadio0 = document.getElementById('option0'); // input
            const qRadio1 = document.getElementById('option1'); // input
            // --- END ADDED ---

            // --- Functions ---

            // --- REMOVED: getQuestionHTML function is no longer needed ---

            // --- REWRITTEN: showQuestion to update in-place ---
            function showQuestion(isInitial = false) {
                const question = questions[currentQuestionIndex];
                const [letter1_raw, letter2_raw] = question.type.split('/');
                const letter1 = letter1_raw.trim();
                const letter2 = letter2_raw.trim();

                const transitionTime = isInitial ? 0 : 200; // 200ms fade-out time

                // 1. Start fade-out (if not initial)
                if (!isInitial) {
                    qContainer.classList.add('transitioning');
                }

                // 2. Wait for fade-out to complete
                setTimeout(() => {
                    // 3. Update all the content
                    qNumber.textContent = currentQuestionIndex + 1;
                    qText.textContent = question.text;
                    
                    qLabel0.textContent = question.options[0];
                    qOption0.dataset.value = letter1;
                    qRadio0.value = letter1;

                    qLabel1.textContent = question.options[1];
                    qOption1.dataset.value = letter2;
                    qRadio1.value = letter2;

                    // 4. Reset options
                    qOption0.classList.remove('selected');
                    qOption1.classList.remove('selected');
                    qRadio0.checked = false;
                    qRadio1.checked = false;

                    // 5. Restore previous answer
                    const previousAnswer = userAnswers[currentQuestionIndex];
                    if (previousAnswer) {
                        if (previousAnswer === letter1) {
                            qOption0.classList.add('selected');
                            qRadio0.checked = true;
                        } else if (previousAnswer === letter2) {
                            qOption1.classList.add('selected');
                            qRadio1.checked = true;
                        }
                    }

                    // 6. Update navigation
                    updateNavigation();

                    // 7. Prepare for fade-in (move to start position)
                    if (!isInitial) {
                        // Set start transform (invisible)
                        qContainer.style.transform = 'translateY(10px)';
                        qContainer.style.transition = 'none'; // No transition for this snap

                        // 8. Force browser reflow
                        void qContainer.offsetHeight; 

                        // 9. Re-enable transitions and remove class to fade in
                        qContainer.style.transition = 'opacity 0.2s ease-in-out, transform 0.2s ease-in-out';
                        qContainer.style.transform = 'translateY(0)';
                        qContainer.classList.remove('transitioning'); // Fades in (opacity 0 -> 1)
                    } else {
                        // For initial load, just make it visible
                        qContainer.style.opacity = 1; 
                    }
                    
                    // 10. Release lock
                    isAdvancing = false;

                }, transitionTime);
            }
            // --- END REWRITTEN ---

            // --- REWRITTEN: handleOptionClick to work with new elements ---
            function handleOptionClick(optionEl) {
                if (isAdvancing) return; 
                isAdvancing = true; // Prevent multiple clicks

                const selectedValue = optionEl.dataset.value;
                userAnswers[currentQuestionIndex] = selectedValue;

                // Update UI for selection
                qOption0.classList.remove('selected');
                qOption1.classList.remove('selected');
                optionEl.classList.add('selected');
                
                if (optionEl === qOption0) {
                    qRadio0.checked = true;
                } else {
                    qRadio1.checked = true;
                }

                // Advance
                setTimeout(() => {
                    if (currentQuestionIndex < questions.length - 1) {
                        currentQuestionIndex++;
                        showQuestion(); // showQuestion will release the lock
                    } else {
                        // On the last question, just update navigation
                        updateNavigation();
                        isAdvancing = false; // Release lock
                    }
                }, 200); 
            }
            // --- END REWRITTEN ---

            function updateNavigation() {
                prevBtn.disabled = currentQuestionIndex === 0;
                
                // --- BUG FIX 2: Always hide the 'Next' button per user request ---
                nextBtn.style.display = 'none'; 
                
                if (currentQuestionIndex === questions.length - 1) {
                    // Only show Finish button on the last question
                    finishBtn.style.display = 'inline-block';
                    
                    // Check if all questions are answered to enable/disable Finish
                    const allAnswered = userAnswers.every(answer => answer !== null);
                    finishBtn.disabled = !allAnswered;
                } else {
                    // Not the last question, hide Finish button
                    finishBtn.style.display = 'none';
                }
            }

            function showResults() {
                quizSection.style.display = 'none';
                resultsPage.style.display = 'block';

                const scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                userAnswers.forEach(answer => {
                    if (answer) {
                        scores[answer]++;
                    }
                });

                scores.E *= 2;
                scores.I *= 2;
                
                const colorMap = {
                    'E': { bg: 'rgba(68, 179, 225, 0.9)', border: 'rgba(68, 179, 225, 1)' },     // User: #44B3E1
                    'I': { bg: 'rgba(234, 228, 0, 0.9)', border: 'rgba(234, 228, 0, 1)' },     // User: #EAE400
                    'S': { bg: 'rgba(255, 153, 0, 0.9)', border: 'rgba(255, 153, 0, 1)' },     // User: #FF9900
                    'N': { bg: 'rgba(120, 33, 112, 0.9)', border: 'rgba(120, 33, 112, 1)' },     // User: #782170
                    'T': { bg: 'rgba(33, 92, 152, 0.9)', border: 'rgba(33, 92, 152, 1)' },     // User: #215C98
                    'F': { bg: 'rgba(78, 167, 46, 0.9)', border: 'rgba(78, 167, 46, 1)' },     // User: #4EA72E
                    'J': { bg: 'rgba(235, 21, 21, 0.9)', border: 'rgba(235, 21, 21, 1)' },     // User: #EB1515
                    'P': { bg: 'rgba(153, 102, 51, 0.9)', border: 'rgba(153, 102, 51, 1)' }      // User: #996633
                };

                const finalData = [];
                const otherLetters = []; // <-- NEW: To store the "losing" letters
                let realScore, displayScore;

                if (scores.E >= scores.I) {
                    realScore = scores.E;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'E', score: displayScore, realScore: realScore });
                    otherLetters.push('I'); // <-- NEW
                } else {
                    realScore = scores.I;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'I', score: displayScore, realScore: realScore });
                    otherLetters.push('E'); // <-- NEW
                }

                if (scores.S >= scores.N) {
                    realScore = scores.S;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'S', score: displayScore, realScore: realScore });
                    otherLetters.push('N'); // <-- NEW
                } else {
                    realScore = scores.N;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'N', score: displayScore, realScore: realScore });
                    otherLetters.push('S'); // <-- NEW
                }

                if (scores.T >= scores.F) {
                    realScore = scores.T;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'T', score: displayScore, realScore: realScore });
                    otherLetters.push('F'); // <-- NEW
                } else {
                    realScore = scores.F;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'F', score: displayScore, realScore: realScore });
                    otherLetters.push('T'); // <-- NEW
                }

                if (scores.J >= scores.P) {
                    realScore = scores.J;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'J', score: displayScore, realScore: realScore });
                    otherLetters.push('P'); // <-- NEW
                } else {
                    realScore = scores.P;
                    displayScore = Math.min(realScore, 20); 
                    finalData.push({ letter: 'P', score: displayScore, realScore: realScore });
                    otherLetters.push('J'); // <-- NEW
                }
                
                const chartLabels = finalData.map(d => d.letter);
                const chartData = finalData.map(d => d.score); 
                const chartRealScores = finalData.map(d => d.realScore); 
                const chartBackgroundColors = finalData.map(d => colorMap[d.letter].bg);
                const chartBorderColors = finalData.map(d => colorMap[d.letter].border);

                const personalityTypeString = chartLabels.join('');
                
                const personalityWordsArray = chartLabels.map(letter => {
                    const fullWord = wordMap[letter]; // Es: "iNtuitive"
                    const keyIndex = fullWord.toLowerCase().indexOf(letter.toLowerCase());
                    if (keyIndex === -1) { return fullWord; }
                    const before = fullWord.substring(0, keyIndex); 
                    const keyChar = fullWord.substring(keyIndex, keyIndex + 1); 
                    const after = fullWord.substring(keyIndex + 1); 
                    return `${before}<strong>${keyChar}</strong>${after}`;
                });
                const personalityWordsHTML = personalityWordsArray.join(' - ');

                if (personalityTypeEl) {
                    personalityTypeEl.textContent = personalityTypeString;
                }
                if (personalityWordsEl) {
                    personalityWordsEl.innerHTML = personalityWordsHTML; 
                }

                // --- ADDED: Populate letter definitions grid ---
                const letterGrid = document.getElementById('letter-grid');
                if (chartLabels.length === 4) {
                    letterGrid.style.display = 'grid'; // Show the grid
                    for (let i = 0; i < 4; i++) {
                        const letter = chartLabels[i];
                        const fullWord = wordMap[letter];
                        const description = letterDescriptions[letter];
                        const color = colorMap[letter].border; // Get color from chart map (e.g., 'rgba(R, G, B, 1)')

                        // NEW: Create a light background shade (10% opacity)
                        const bgColor = color.replace(', 1)', ', 0.1)');

                        const cardElement = document.getElementById(`letter-card-${i}`); // Get the <details> element
                        
                        cardElement.style.borderColor = color;
                        cardElement.style.backgroundColor = bgColor; // <-- ADDED BACKGROUND SHADE

                        document.getElementById(`letter-title-${i}`).textContent = fullWord;
                        document.getElementById(`letter-desc-${i}`).textContent = description;
                    }
                } else {
                    letterGrid.style.display = 'none'; // Hide if something's wrong
                }
                // --- END ADDED ---

                // --- NEW: Populate other letters grid ---
                const otherLetterGrid = document.getElementById('other-letter-grid');
                if (otherLetters.length === 4) {
                    // otherLetterGrid.style.display = 'grid'; // Don't show by default
                    for (let i = 0; i < 4; i++) {
                        const letter = otherLetters[i];
                        const fullWord = wordMap[letter];
                        const description = letterDescriptions[letter];
                        const color = colorMap[letter].border;

                        const cardElement = document.getElementById(`other-letter-card-${i}`);
                        
                        cardElement.style.borderColor = color;
                        // cardElement.style.backgroundColor = 'transparent'; // Use CSS style

                        document.getElementById(`other-letter-title-${i}`).textContent = fullWord;
                        document.getElementById(`other-letter-desc-${i}`).textContent = description;
                    }
                }
                // --- END NEW ---


                // --- ADDED: Populate new description sections ---
                const description = personalityDescriptions[personalityTypeString] || "Your personality description will appear here.";
                
                document.getElementById('desc-overview').textContent = description;
                
                // Update dynamic titles
                document.getElementById('title-partner').textContent = `${personalityTypeString} as a Partner`;
                document.getElementById('title-workplace').textContent = `${personalityTypeString} in the Workplace`;
                document.getElementById('title-leader').textContent = `${personalityTypeString} as a Leader`;
                // --- END ADDED ---

                const ctx = document.getElementById('resultsChart').getContext('2d');

                if (resultsChartInstance) {
                    resultsChartInstance.destroy();
                }

                resultsChartInstance = new Chart(ctx, {
                    type: 'bar', 
                    data: {
                        labels: chartLabels, 
                        datasets: [
                            {
                                label: 'Score',
                                data: chartData, 
                                realScores: chartRealScores, 
                                backgroundColor: chartBackgroundColors,
                                borderColor: chartBorderColors,
                                borderWidth: 1,
                                borderRadius: 5,
                                borderSkipped: false,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false 
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const realScore = context.dataset.realScores[context.dataIndex];
                                        if (label) {
                                            return `${label}: ${realScore}`;
                                        }
                                        return `${realScore}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { 
                                grid: {
                                    display: false, 
                                    borderColor: '#ccc'
                                },
                                ticks: {
                                    font: {
                                        family: 'Poppins',
                                        size: 14,
                                        weight: '600'
                                    },
                                    color: '#2c3e50'
                                }
                            },
                            y: { 
                                beginAtZero: true,
                                max: 23, 
                                grid: {
                                    color: '#e0e6ed', 
                                    borderColor: '#ccc'
                                },
                                ticks: {
                                    font: {
                                        family: 'Poppins'
                                    },
                                    color: '#333'
                                }
                            }
                        }
                    }
                });
            }
            
            function restartQuiz() {
                currentQuestionIndex = 0;
                userAnswers.fill(null);
                
                resultsPage.style.display = 'none';
                quizSection.style.display = 'none'; // ADDED: Hide quiz section
                /* quizContainer.style.display = 'none'; */ // REMOVED: Container stays visible
                coverPage.style.display = 'flex'; // Show cover view
                /* coverPage.classList.remove('hidden'); */ // REMOVED: Not needed

                if (resultsChartInstance) {
                    resultsChartInstance.destroy();
                    resultsChartInstance = null;
                }
                
                if (personalityTypeEl) {
                    personalityTypeEl.textContent = '';
                }
                if (personalityWordsEl) {
                    personalityWordsEl.innerHTML = ''; 
                }

                // --- ADDED: Hide letter grid and reset accordions ---
                document.getElementById('letter-grid').style.display = 'none';
                // Reset main accordions
                document.querySelectorAll('.result-section').forEach((detail, index) => {
                    // Close all
                    detail.open = false;
                });
                // ADDED: Reset letter card accordions
                document.querySelectorAll('.letter-card').forEach(detail => {
                    detail.open = false;
                    // NEW: Reset inline styles
                    detail.style.borderColor = '';
                    detail.style.backgroundColor = '';
                });
                
                // --- NEW: Reset other perspectives section ---
                const otherGrid = document.getElementById('other-letter-grid');
                const otherBtn = document.getElementById('showOtherBtn');
                if (otherGrid) otherGrid.style.display = 'none';
                if (otherBtn) otherBtn.textContent = 'Show Opposite Types';

                document.querySelectorAll('.other-letter-card').forEach(detail => {
                    detail.open = false;
                    detail.style.borderColor = '';
                });
                // --- END NEW ---
            }

            function generateRandomResults() {
                if (isAdvancing) return; 
                
                /* coverPage.classList.add('hidden'); */ // REMOVED
                /* setTimeout(() => { */
                    coverPage.style.display = 'none'; // Hide cover view
                    /* quizContainer.style.display = 'block'; */ // REMOVED: Container stays visible
                    quizSection.style.display = 'block'; // Show quiz view
                /* }, 500); */

                userAnswers = questions.map(q => {
                    // FIX: Ensure q.type is a string before splitting
                    if (typeof q.type !== 'string' || !q.type.includes('/')) {
                        console.error('Invalid question type:', q);
                        return null; // Or a default value, but null is safer for score counting
                    }
                    const [letter1_raw, letter2_raw] = q.type.split('/');
                    const letter1 = letter1_raw.trim();
                    const letter2 = letter2_raw.trim();
                    return Math.random() < 0.5 ? letter1 : letter2;
                });

                /* setTimeout(showResults, 600); */
                showResults(); // Call directly, no timeout needed
            }


            // --- Event Listeners ---
            startBtn.addEventListener('click', () => { 
                if (isAdvancing) return; // <-- ADDED: Check lock
                isAdvancing = true;     // <-- ADDED: Acquire lock
                /* coverPage.classList.add('hidden'); */ // REMOVED
                /* setTimeout(() => { */
                    coverPage.style.display = 'none'; // Hide cover view
                    /* quizContainer.style.display = 'block'; */ // REMOVED: Container stays visible
                    quizSection.style.display = 'block'; // Show quiz view
                    document.body.style.overflow = 'auto'; 
                    showQuestion(true); // <-- MODIFIED: Pass true for initial load
                /* }, 500); */
            });

            prevBtn.addEventListener('click', () => {
                if (isAdvancing) return; 
                isAdvancing = true; // <-- ADDED: Acquire lock on click
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    showQuestion();
                } else {
                    isAdvancing = false; // <-- ADDED: Release lock if no action is taken
                }
            });
            
            nextBtn.addEventListener('click', () => {
                // This button is hidden, but the listener does no harm
                if (isAdvancing) return; 
                isAdvancing = true; // <-- ADDED: Acquire lock on click (for robustness)
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion();
                } else {
                    isAdvancing = false; // <-- ADDED: Release lock if no action is taken
                }
            });
            
            finishBtn.addEventListener('click', () => {
                if (isAdvancing) return; 
                showResults();
            });
            
            restartBtn.addEventListener('click', restartQuiz);

            randomBtn.addEventListener('click', generateRandomResults); 

            // --- ADDED: Static event listeners ---
            qOption0.addEventListener('click', () => handleOptionClick(qOption0));
            qOption1.addEventListener('click', () => handleOptionClick(qOption1));
            // --- END ADDED ---

            // --- ADDED: Accordion logic ---
            function setupAccordion(containerSelector, itemSelector) {
                const items = document.querySelectorAll(itemSelector);
                if (!items.length) return;

                items.forEach(item => {
                    item.addEventListener('toggle', (e) => {
                        // Only act if the details element is being opened
                        if (item.open) {
                            // Close all other items in this group
                            items.forEach(otherItem => {
                                if (otherItem !== item && otherItem.open) {
                                    otherItem.open = false;
                                }
                            });
                        }
                    });
                });
            }

            // Setup for the letter definitions grid
            setupAccordion('.letter-definitions-grid', '.letter-card');

            // Setup for the results details section
            setupAccordion('.results-details', '.result-section');

            // --- NEW: Setup for the other letter grid ---
            setupAccordion('.other-letter-grid', '.other-letter-card');

            const showOtherBtn = document.getElementById('showOtherBtn');
            const otherLetterGrid = document.getElementById('other-letter-grid');

            if (showOtherBtn && otherLetterGrid) {
                showOtherBtn.addEventListener('click', () => {
                    const isHidden = otherLetterGrid.style.display === 'none' || otherLetterGrid.style.display === '';
                    if (isHidden) {
                        otherLetterGrid.style.display = 'grid';
                        showOtherBtn.textContent = 'Hide Opposite Types';
                    } else {
                        otherLetterGrid.style.display = 'none';
                        showOtherBtn.textContent = 'Show Opposite Types';
                    }
                });
            }
            // --- END NEW ---
            
        }); 
    </script>

</body>
</html>










