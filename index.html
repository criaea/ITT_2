<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUNG TYPOLOGY</title>
    
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel&family=Comfortaa&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Basic Styles --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalFadeIn {
            from { 
                opacity: 0; 
                transform: translateY(-20px) scale(0.95);
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }
        
        body {
            background-color: #f0f4f9; 
            color: #333;
            line-height: 1.6;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            width: 100%;
            margin: 20px auto; 
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
        }

        .question-container {
            margin-bottom: 25px;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        }

        .question-container.transitioning {
            opacity: 0;
            transform: translateY(-10px); /* Fades out by moving up */
        }

        .question-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(37, 117, 252, 0.3);
            flex-shrink: 0;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.25rem;
            text-align: center;
            line-height: 1.5;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }
        
        .option {
            display: flex;
            align-items: center;
            justify-content: center; /* Center text */
            text-align: center; /* Center text */
            padding: 20px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: rgba(248, 249, 250, 0.8);
            min-height: 80px; /* Ensure options have same height */
        }
        
        .option:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-color: #a0b4c8;
        }
        
        .option.selected {
            background-color: #e3f2fd;
            border-color: #2575fc;
            box-shadow: 0 8px 25px rgba(37, 117, 252, 0.2);
            transform: translateY(-4px);
            color: #2575fc; /* Change text color when selected */
            font-weight: 600; /* Make text bold when selected */
        }
        
        .option input {
            display: none; /* Hide the radio button */
        }
        
        /* --- Navigation Styles --- */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        
        button {
            padding: 12px 28px;
            background: linear-gradient(145deg, #5a29e4, #3a68d8);
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 
                        inset 0 1px 1px rgba(255, 255, 255, 0.2);
            text-shadow: 0 -1px 0 rgba(0,0,0,0.2);
            white-space: nowrap;
        }
        
        button:hover {
            background: linear-gradient(145deg, #6b3ef0, #4c7ce0);
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 
                        0 3px 6px rgba(0, 0, 0, 0.08),
                        inset 0 1px 1px rgba(255, 255, 255, 0.2);
        }

        button:active {
            transform: translateY(1px);
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 
                        inset 0 2px 3px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            color: #7f8c8d;
            text-shadow: none;
        }

        /* --- Cover Page Styles --- */
        #coverPage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center vertically */
            text-align: center;
            padding: 20px 0; /* Add some vertical padding */
        }

        /* --- Feature List Styles --- */
        .features-list {
            display: flex;
            flex-direction: column;
            gap: 25px; /* Increased gap */
            margin: 30px 0;
            width: 100%;
            max-width: 600px; /* Increased max-width */
            align-items: flex-start; /* Align items to the left of the container */
        }

        .feature-item {
            display: flex;
            align-items: flex-start; /* Align icon to the top */
            gap: 20px;
        }

        .feature-icon {
            width: 100px; /* Standardized size */
            height: auto; /* Maintain aspect ratio */
            border-radius: 0; 
            object-fit: contain; 
            background-color: transparent; 
            box-shadow: none; 
            flex-shrink: 0;
            margin-top: 4px; /* Align icon with first line of text */
        }

        .feature-text-content {
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 4px; /* Small gap between title and description */
        }

        .feature-title {
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 600; /* Bolder */
        }
        
        .feature-description {
            font-size: 0.95rem; /* Slightly smaller */
            color: #34495e; 
            font-weight: 400; /* Regular weight */
            line-height: 1.5;
        }

        #coverTitle.cover-title {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 400;
            margin-bottom: 30px; 
            letter-spacing: 1px;
            color: #2c3e50;
        }
        
        /* Logo style from index.html (REMOVED) */
        /*
        #coverTitle .itt-logo {
            font-family: 'Comfortaa', cursive;
            font-weight: 400; 
            font-size: 1.0em; 
            vertical-align: middle; 
        }
        */

        #startBtn {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 15px 40px;
            border-radius: 50px; 
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); 
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(37, 117, 252, 0.3);
            margin-top: 30px;
        }
        
        #startBtn:hover {
            transform: translateY(-3px) scale(1.05); 
            box-shadow: 0 8px 25px rgba(37, 117, 252, 0.4);
        }


        /* --- Results Page Styles --- */
        #resultsPage {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-in-out;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            max-width: 600px; /* Constrain chart width */
            margin: 0 auto;
        }
        
        .personality-type-display {
            font-size: 3.5rem; 
            font-weight: 700; 
            color: #2c3e50; 
            text-align: center; 
            margin-top: 25px; 
            letter-spacing: 2px; 
        }

        .personality-words-display {
            font-size: 1.25rem;
            color: #2c3e50; 
            text-align: center;
            letter-spacing: 1px;
            font-weight: 600; 
            padding: 18px 25px; 
            border-bottom: 1px solid #e0e6ed; 
        }
        
        .personality-words-display strong {
             color: #2575fc; /* Use main accent blue */
             font-size: 1.1em; /* Make it slightly larger */
             font-weight: 700; /* Ensure it's bold */
        }

        .restart-button-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .opposite-type-header {
            text-align: center;
            font-size: 1.5rem;
            color: #34495e; 
            font-weight: 600;
            margin-bottom: 20px;
            margin-top: 10px; 
        }

        .toggle-other-container {
            display: flex;
            justify-content: center;
            margin-top: 25px;
            margin-bottom: 25px;
        }

        .other-toggle-btn {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            padding: 12px 30px;
            border-radius: 50px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border: 2px solid #a881ef;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px #a881ef, 0 0 20px #a881ef, inset 0 0 5px rgba(255, 255, 255, 0.2);
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.4);
        }
        
        .other-toggle-btn:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 0 15px #a881ef, 0 0 30px #a881ef, inset 0 0 5px rgba(255, 255, 255, 0.3);
        }

        /* --- Letter Definition Grid Styles --- */
        .letter-definitions-grid {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 20px;
            margin: 30px 0;
            display: none; /* Hidden by default, shown by JS */
        }

        .letter-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-top: 5px solid #ccc; /* Default border, color set by JS */
            transition: all 0.3s ease;
            overflow: hidden; 
        }

        .letter-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }

        .letter-card-title {
            font-weight: 700;
            font-size: 1.25rem;
            color: #2c3e50;
            margin-bottom: 0; 
            padding: 20px; 
            padding-right: 50px; /* for icon */
            cursor: pointer; 
            position: relative; 
            list-style: none; 
        }
        
        .letter-card-title::-webkit-details-marker {
            display: none;
        }

        /* Custom arrow for letter card */
        .letter-card-title::after {
            content: '+';
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem; 
            font-weight: 300;
            color: #2575fc;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.2s ease;
        }

        .letter-card[open] > .letter-card-title::after {
            content: '−';
            transform: translateY(-50%) rotate(180deg);
        }

        .letter-card-desc {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #34495e;
            padding: 0 20px 20px 20px; 
        }

        /* --- Result Details Section Styles (Empty) --- */
        .results-details {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 5px solid #000; 
        }

        .result-section {
            margin-bottom: 15px; 
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #e0e6ed;
            overflow: hidden; 
        }

        .result-section[open] {
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }

        .result-section-title {
            font-size: 1.25rem; 
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0; 
            padding: 18px 25px;
            border-bottom: none; 
            display: block; 
            cursor: pointer;
            position: relative;
            list-style: none; /* Remove default marker */
        }

        .result-section-title::-webkit-details-marker {
            display: none; 
        }

        /* Custom Accordion Arrow */
        .result-section-title::after {
            content: '+';
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 300;
            color: #2575fc;
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.2s ease;
        }

        .result-section[open] > .result-section-title::after {
            content: '−'; /* Minus sign */
            transform: translateY(-50%) rotate(180deg);
        }

        .result-section-content {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #34495e;
            padding: 25px; 
        }

        /* Style for the main overview paragraph */
        #desc-overview {
            font-style: italic;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .placeholder {
            color: #7f8c8d;
            font-style: italic;
        }

        /* --- NEW: Profile Grid Styles --- */
        .profile-grid-container {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e0e6ed;
        }

        .profile-grid-title {
            text-align: center;
            font-size: 1.5rem;
            color: #34495e; 
            font-weight: 600;
            margin-bottom: 25px;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            border: 1px solid #ccc;
            border-radius: 8px;
            /* overflow: hidden; */ /* --- FIX: Removed to prevent highlight clipping --- */
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .profile-cell {
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease; /* Added border */
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
        }
        
        /* Remove extra borders */
        .profile-cell:nth-child(4n) {
            border-right: none;
        }
        .profile-cell:nth-child(n+13) { /* Last row */
            border-bottom: none;
        }

        .profile-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 10;
        }

        /* --- MODIFIED: New Highlight Style --- */
        .profile-cell.highlight {
            /* Use a distinct background color for the new highlight */
            background-color: #e3f2fd; /* Light blue (from quiz option selected) */
            border: 2px solid #2575fc;
            /* Remove old transform and shadow */
            transform: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); /* Keep a subtle shadow */
            z-index: 11; 
        }
        
        /* Ensure text is readable on new highlight */
        .profile-cell.highlight .profile-cell-type,
        .profile-cell.highlight .profile-cell-title {
            color: #2c3e50; 
        }

        /* Prevent hover effect on the already-highlighted cell */
        .profile-cell.highlight:hover {
             transform: none;
             box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        /* --- END MODIFIED --- */

        .profile-cell-type {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Cinzel', serif;
            margin-bottom: 8px;
        }
        
        .profile-cell-title {
            font-size: 0.8rem;
            font-weight: 500;
            line-height: 1.3;
        }

        /* Colors based on user image */
        .cell-color-a {
            background-color: #f7ead0; /* Lighter tan/orange */
            color: #2c3e50;
        }
        .cell-color-b {
            background-color: #2c3e50; /* Dark blue/grey */
            color: #f7ead0;
        }
        /* --- END NEW: Profile Grid Styles --- */


        /* --- NEW: Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            max-width: 550px;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            position: relative;
            animation: modalFadeIn 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2.5rem;
            line-height: 1;
            color: #aaa;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0; /* Reset button padding */
            box-shadow: none; /* Reset button shadow */
            font-weight: 300;
        }
        .modal-close:hover {
            color: #333;
            transform: none; /* Reset button hover */
            box-shadow: none;
        }

        .modal-profile-title {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 5px;
        }

        .modal-profile-subtitle {
            font-size: 1.1rem;
            font-weight: 500;
            color: #555;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e6ed;
            padding-bottom: 15px;
        }

        .modal-profile-description {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #34495e;
            font-style: italic;
        }
        /* --- END NEW: Modal Styles --- */

        
        /* --- Mobile Optimizations --- */
        @media (max-width: 768px) {
            body { 
                padding: 0; 
                display: block; /* Allow natural flow on mobile */
            }
            .container {
                border-radius: 0;
                padding: 20px;
                min-height: 100vh;
                width: 100%;
                margin: 0; /* Full width on mobile */
            }
            .navigation { 
                flex-direction: column; 
                gap: 15px; 
            }
            
            .dev-navigation {
                order: -1; /* Move dev button to top on mobile */
                width: 100%;
            }
            
            .dev-navigation button {
                width: 100%;
            }
            
            .navigation button {
                width: 100%; /* Make buttons full width */
            }
            
            .options-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .features-list {
                align-items: center; /* Center list container on mobile */
                max-width: 100%;
                padding: 0 10px;
            }
            
            .feature-item {
                gap: 15px;
                width: 100%; /* Make items take full width */
                max-width: 350px; /* But not too wide */
                align-items: center; /* Center icon and text block vertically */
            }
            
            .feature-icon {
                width: 80px; /* Adjusted mobile size */
                height: auto; /* Maintain aspect ratio */
                margin-top: 0; /* Reset margin */
            }
            
            .feature-title {
                font-size: 1rem; 
            }
            
            .feature-description {
                font-size: 0.9rem;
            }
            
            #coverTitle.cover-title {
                font-size: 2rem;
            }
            #startBtn {
                padding: 12px 30px;
                font-size: 1rem;
            }

            /* --- NEW: Mobile Profile Grid --- */
            /* --- MODIFIED: Make container scroll horizontally on mobile --- */
            .profile-grid-container {
                overflow-x: auto;
                padding-bottom: 10px; /* Space for scrollbar */
            }

            .profile-grid {
                /* Keep the 4-column layout and force a min-width */
                min-width: 600px; 
                /* REMOVED: grid-template-columns: repeat(2, 1fr); */
            }
            
            /* --- REMOVED all 2-column border fix rules --- */
            /*
            .profile-cell:nth-child(4n) {
                border-right: 1px solid #ddd; 
            }
            .profile-cell:nth-child(2n) {
                border-right: none; 
            }
            .profile-cell:nth-child(n+13) { 
                border-bottom: 1px solid #ddd; 
            }
            .profile-cell:nth-child(n+15) { 
                border-bottom: none;
            }
            */

            .profile-cell {
                min-height: 100px;
                padding: 10px 5px;
            }
            .profile-cell-type {
                font-size: 1.2rem;
            }
            .profile-cell-title {
                font-size: 0.75rem;
            }
            /* --- END NEW: Mobile Profile Grid --- */
        }

    </style>
</head>
<body>
    
    <div class="container">
        
        <div id="coverPage">
            <h1 id="coverTitle" class="cover-title">JUNG TYPOLOGY</h1>
            
            <!-- --- MODIFIED: Feature List --- -->
            <div class="features-list">
                
                <div class="feature-item">
                    <img src="conflict.png" alt="Improving communications" class="feature-icon" onerror="this.src='https://placehold.co/100x100/6a11cb/ffffff?text=Icon'; this.onerror=null;">
                    <div class="feature-text-content">
                        <h4 class="feature-title">Improving Communications</h4>
                        <p class="feature-description">The test helps build self-esteem and manage conflict by focusing on the positive contributions of each personality type. It gives people a framework for valuing their differences.</p>
                    </div>
                </div>

                <div class="feature-item">
                    <img src="podium.png" alt="Develop individual success" class="feature-icon" onerror="this.src='https://placehold.co/100x100/2575fc/ffffff?text=Icon'; this.onerror=null;">
                    <div class="feature-text-content">
                        <h4 class="feature-title">Develop Individual Success</h4>
                        <p class="feature-description">The test provides practical insight into what motivates and de-motivates an individual. This allows you to map your own personal success and create a plan for improvement.</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <img src="self.png" alt="Better self-understanding" class="feature-icon" onerror="this.src='https://placehold.co/100x100/6a11cb/ffffff?text=Icon'; this.onerror=null;">
                    <div class="feature-text-content">
                        <h4 class="feature-title">Better Self-Understanding</h4>
                        <p class="feature-description">The test helps individuals get to know themselves better, which is a source of great satisfaction. It helps you understand what motivates you and discover your unique potential.</p>
                    </div>
                </div>
                
                <div class="feature-item">
                    <img src="career.png" alt="Career guidance" class="feature-icon" onerror="this.src='https://placehold.co/100x100/2575fc/ffffff?text=Icon'; this.onerror=null;">
                    <div class="feature-text-content">
                        <h4 class="feature-title">Career Guidance</h4>
                        <p class="feature-description">Self-awareness is the key to good career guidance, as personal style affects motivation. The MBTI helps individuals assess which careers or job opportunities are a good fit.</p>
                    </div>
                </div>

            </div>
            <!-- --- END MODIFIED --- -->

             <button id="startBtn">Begin the Evaluation</button>
        </div>

        <!-- Quiz Section -->
        <div id="quizSection" style="display: none;"> 
            <h1>JUNG TYPOLOGY</h1>
            
            <div id="questionnaire">
                <div class="question-container" id="q-container" style="opacity: 0;"> <!-- Start hidden -->
                    <div class="question-number" id="q-number">1</div>
                    <div class="question-text" id="q-text">Loading...</div>
                    <div class="options-container">
                        <div class="option" id="q-option-0" data-value="">
                            <input type="radio" name="q_radio" id="option0" value="">
                            <label for="option0" id="q-label-0">Option A</label>
                        </div>
                        <div class="option" id="q-option-1" data-value="">
                            <input type="radio" name="q_radio" id="option1" value="">
                            <label for="option1" id="q-label-1">Option B</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dev Button -->
            <div class="dev-navigation" style="text-align: right; margin-bottom: 10px; margin-top: 15px;">
                <button id="randomBtn" style="background: #f39c12; border-color: #f39c12;">Dev: Random Results</button>
            </div>

            <div class="navigation" id="mainNavigation">
                <button id="prevBtn">Previous</button>
                <button id="nextBtn" style="display: none;">Next</button>
                <button id="finishBtn" style="display: none;">Finish</button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div id="resultsPage" style="display: none;">
            <h1>Your Results</h1>
            <div class="chart-container">
                <canvas id="resultsChart"></canvas>
            </div>
            
            <div id="personalityType" class="personality-type-display"></div> 

            <div class="result-section-static">
                <div id="personalityWords" class="personality-words-display"></div> 
                <p id="desc-overview" class="result-section-content"></p>
            </div>

            <div class="letter-definitions-grid" id="letter-grid">
                <details class="letter-card" id="letter-card-0">
                    <summary class="letter-card-title" id="letter-title-0"></summary>
                    <p class="letter-card-desc" id="letter-desc-0"></p>
                </details>
                <details class="letter-card" id="letter-card-1">
                    <summary class="letter-card-title" id="letter-title-1"></summary>
                    <p class="letter-card-desc" id="letter-desc-1"></p>
                </details>
                <details class="letter-card" id="letter-card-2">
                    <summary class="letter-card-title" id="letter-title-2"></summary>
                    <p class="letter-card-desc" id="letter-desc-2"></p>
                </details>
                <details class="letter-card" id="letter-card-3">
                    <summary class="letter-card-title" id="letter-title-3"></summary>
                    <p class="letter-card-desc" id="letter-desc-3"></p>
                </details>
            </div>

            <div class="results-details">
                <!-- Empty as requested -->
            </div>

            <div class="toggle-other-container">
                <button id="showOtherBtn" class="other-toggle-btn">Show Converse Profile</button> 
            </div>

            <h3 id="oppositeTypeHeader" class="opposite-type-header" style="display: none;"></h3>

            <div class="letter-definitions-grid other-letter-grid" id="other-letter-grid">
                <details class="letter-card other-letter-card" id="other-letter-card-0">
                    <summary class="letter-card-title" id="other-letter-title-0"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-0"></p>
                </details>
                <details class="letter-card other-letter-card" id="other-letter-card-1">
                    <summary class="letter-card-title" id="other-letter-title-1"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-1"></p>
                </details>
                <details class="letter-card other-letter-card" id="other-letter-card-2">
                    <summary class="letter-card-title" id="other-letter-title-2"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-2"></p>
                </details>
                <details class="letter-card other-letter-card" id="other-letter-card-3">
                    <summary class="letter-card-title" id="other-letter-title-3"></summary>
                    <p class="letter-card-desc" id="other-letter-desc-3"></p>
                </details>
            </div>

            <!-- --- NEW: Profile Grid Section --- -->
            <div class="profile-grid-container">
                <h3 class="profile-grid-title">Discover Jung's 16 Profiles</h3>
                <div id="profileGrid" class="profile-grid">
                    <!-- This will be populated by JavaScript -->
                </div>
            </div>
            <!-- --- END NEW --- -->


            <div class="restart-button-container">
                 <button id="restartBtn">Take Again</button>
            </div>
        </div>
    </div>

    <!-- --- NEW: Profile Modal --- -->
    <div id="profileModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button id="modalCloseBtn" class="modal-close">&times;</button>
            <h4 id="modalTitle" class="modal-profile-title"></h4>
            <p id="modalSubtitle" class="modal-profile-subtitle"></p>
            <p id="modalDescription" class="modal-profile-description"></p>
        </div>
    </div>
    <!-- --- END NEW --- -->


    <script>
    document.addEventListener('DOMContentLoaded', () => {

            // --- Questions Data ---
            const questions = [
                { type: "S/N", text: "Are you", options: ["observant of your surroundings", "introspective and thinking"] },
                { type: "E/I", text: "Waiting for the train, do you?", options: ["chat to others", "stay silent"] },
                { type: "T/F", text: "When dealing with people are you?", options: ["Direct", "gentle"] },
                { type: "J/P", text: "Does workplace clutter?", options: ["stress you", "are you indifferent"] },
                { type: "T/F", text: "Which is easier for you to give?", options: ["critical/direct feedback", "avoid the vital details"] },
                { type: "S/N", text: "Do you?", options: ["Keep to the tried and trusted", "speculate about possibilities"] },
                { type: "J/P", text: "Do you?", options: ["decide instantaneously", "linger over decision making"] },
                { type: "S/N", text: "Are you?", options: ["factual", "imaginative"] },
                { type: "E/I", text: "When the phone rings do you?", options: ["rush to it", "leave others get it"] },
                { type: "T/F", text: "Do you place importance on?", options: ["hard data", "opinion"] },
                { type: "J/P", text: "Do you prefer agreements to?", options: ["be written up and signed", "agreed on word and a handshake"] },
                { type: "T/F", text: "When evaluating others are you?", options: ["impersonal and objective", "subjective and personal"] },
                { type: "S/N", text: "Are you more interested in?", options: ["what is real", "what is possible"] },
                { type: "J/P", text: "Are you more at ease?", options: ["When matters are complete", "with work in progress"] },
                { type: "S/N", text: "Are you always", options: ["Up to date with the news", "some what out of touch"] },
                { type: "E/I", text: "When socialising do you?", options: ["speak with many people", "a few friends"] },
                { type: "T/F", text: "When you are communicating with others do you?", options: ["talk directly", "talk diplomatically"] },
                { type: "J/P", text: "Do you prefer?", options: ["a detailed outline of work done", "a list of completed tasks"] },
                { type: "T/F", text: "Do you prefer?", options: ["A rational consistent approach", "harmonious personal approach"] },
                { type: "S/N", text: "Do you like authors who?", options: ["write hard facts", "use metaphors"] },
                { type: "J/P", text: "Are you more comfortable?", options: ["after a decision", "before a decision"] },
                { type: "S/N", text: "Are visionaries?", options: ["annoying", "fascinating"] },
                { type: "E/I", text: "Does being at a party?", options: ["energise you", "drain you"] },
                { type: "T/F", text: "In an argument/discussion do you?", options: ["act confrontational", "do you seek collaborative solutions"] },
                { type: "J/P", text: "For you is giving feedback?", options: ["easy", "difficult"] },
                { type: "T/F", text: "Which is preferable for you?", options: ["to be just", "to be understanding"] },
                { type: "S/N", text: "‘’Common sense’’ is?", options: ["usually reliable", "occasionally questionable"] },
                { type: "J/P", text: "Do you?", options: ["do one job at a time", "work at many jobs simultaneously"] },
                { type: "S/N", text: "Do you say?", options: ["what is on your mind", "express many opinions"] },
                { type: "E/I", text: "In a group of people do you?", options: ["talk a lot", "listen mostly"] },
                { type: "T/F", text: "Which sums you up best?", options: ["cool headed", "warm hearted"] },
                { type: "J/P", text: "Are you?", options: ["organised", "spontaneous"] },
                { type: "T/F", text: "In work situations do you?", options: ["give orders", "get everyone to find solutions"] },
                { type: "S/N", text: "Do you prefer?", options: ["sensible /factual people", "people who explore options"] },
                { type: "J/P", text: "Do you prefer to?", options: ["work to deadlines", "work whenever"] },
                { type: "S/N", text: "Which do you consider best?", options: ["ability to follow a plan", "adapt and adjust plans"] },
                { type: "E/I", text: "Are you?", options: ["a social person", "a private person"] },
                { type: "T/F", text: "Which are you?", options: ["a logical person", "a feeling person"] },
                { type: "J/P", text: "Do you decide?", options: ["based on analysis", "on a considered hunch"] },
                { type: "T/F", text: "Which is most satisfying for you?", options: ["thorough discussion", "reaching agreement"] },
                { type: "S/N", text: "After a meal do you?", options: ["tidy up immediately", "leave it until later"] },
                { type: "J/P", text: "Does your behaviour be?", options: ["hurried", "laid back"] },
                { type: "S/N", text: "Do you hear what is said as?", options: ["all the story", "most of the story"] },
                { type: "E/I", text: "Do you?", options: ["share your feelings easily", "act reserved"] },
                { type: "T/F", text: "Are you?", options: ["an uncompromising person", "a collaborative person"] },
                { type: "J/P", text: "Do you find it?", options: ["is stressful to change", "easy to reschedule meetings"] },
                { type: "T/F", text: "Are you?", options: ["tough minded", "fair minded"] },
                { type: "S/N", text: "When evaluating a situation do you", options: ["see only what is in front of you", "can you imagine more possibilities"] },
                { type: "J/P", text: "Is your approach?", options: ["ensure everything is arranged", "just let things happen"] },
                { type: "S/N", text: "Do you only trust?", options: ["past experiences", "all possibilities are worth checking"] },
                { type: "E/I", text: "Do you?", options: ["know a little about everything", "know much about a few things"] },
                { type: "T/F", text: "Are you convinced, more often, by?", options: ["hard evidence", "possible outside the box solutions"] },
                { type: "J/P", text: "Is your approach to life?", options: ["structure", "flexible"] },
                { type: "T/F", text: "Which is the greatest asset?", options: ["strength of will", "strength of fair compassion"] },
                { type: "S/N", text: "Do you always feel?", options: ["down to earth", "day dream a little"] },
                { type: "J/P", text: "How do you cope with unexpected events?", options: ["get a good handle on things", "get very stressed"] },
                { type: "S/N", text: "Do you act in?", options: ["Routine way", "whimsical way"] },
                { type: "E/I", text: "Are you?", options: ["a good conversationalist", "a good listener"] },
                { type: "T/F", text: "Are you?", options: ["tough skinned", "sensitive"] },
                { type: "J/P", text: "Do you tend to?", options: ["rely on old ways of doing", "be on the look out for new ways"] },
                { type: "T/F", text: "Do you prefer to?", options: ["operate the production machine", "manage the team of people"] },
                { type: "S/N", text: "Are you more?", options: ["practical", "ingenious"] }, 
                { type: "J/P", text: "Are you?", options: ["more punctual", "leisurely /nonchalant"] },
                { type: "S/N", text: "Do you approach work in?", options: ["an organised and principaled way", "in an innovative and flexible way"] },
                { type: "E/I", text: "Are you?", options: ["social and outgoing", "reserved and quite"] },
                { type: "T/F", text: "Do you most trust?", options: ["your experience", "your hunches"] },
                { type: "J/P", text: "Do you", options: ["are always on the go", "relax, easy going"] },
                { type: "T/F", text: "Which is the greatest error?", options: ["being too passionate", "being too objective"] },
                { type: "S/N", text: "Do you tend to be more?", options: ["More deliberate", "more spontaneous"] },
                { type: "J/P", text: "In evaluating others what influences you most?", options: ["laws", "circumstances"] },
                { type: "S/N", text: "Which do you prefer in stories/film?", options: ["action", "fantasy"] },
                { type: "E/I", text: "In your sports club do you?", options: ["promote activities", "do you do the administration"] },
                { type: "T/F", text: "Which is more difficult for you to?", options: ["to identify with others", "to utilise others"] },
                { type: "J/P", text: "Are you?", options: ["a deadlines person", "a just whenever person"] },
                { type: "T/F", text: "Which is most vital?", options: ["following the to do list", "teamwork"] },
                { type: "S/N", text: "Are you?", options: ["easy to talk to/approach", "shy and reserved"] },
                { type: "J/P", text: "When do you plan your annual holidays?", options: ["months before", "weeks before"] },
                { type: "S/N", text: "Are you attracted to?", options: ["the fundamentals", "the promise"] },
                { type: "T/F", text: "For you which is more important?", options: ["follow the rules", "everyone take full responsibility"] },
                { type: "J/P", text: "Do you use?", options: ["written work schedules", "rely on my memory"] }
            ];

            const wordMap = {
                'E': 'Extroverted',
                'I': 'Introverted',
                'S': 'Sensate',
                'N': 'iNtuitive',
                'T': 'Thinking',
                'F': 'Feeling',
                'J': 'Judging',
                'P': 'Perceiving'
            };

            const letterDescriptions = {
                'E': `The extrovert seeks life in the outer world, drawing energy through engagement and relationships. Yet meaning is not found in activity alone; it emerges when outward action serves a higher purpose, transforming social connection into authentic participation in life.`,
                'I': `The introvert turns inward, seeking understanding through reflection and solitude. True fulfillment arises not from isolation, but from using inner insight to guide purposeful engagement with the world, allowing self-knowledge to become a tool for meaningful contribution.`,
                'S': `The sensate perceives life through the immediate, tangible world, valuing what can be observed and experienced. Meaning is discovered when attention to reality deepens awareness, transforming simple perception into conscious appreciation and purposeful interaction with life’s concrete elements.`,
                'N': `The intuitive perceives possibilities beyond the present, sensing patterns and potential outcomes. Yet insight alone is insufficient. Meaning emerges when intuition is applied to purposeful action, translating foresight into responsible choices that contribute to something greater than oneself.`,
                'T': `The thinking type relies on reason and logic to navigate life, seeking clarity and coherence. Yet intellect becomes meaningful only when aligned with conscience, guiding decisions toward responsibility, contribution, and the affirmation of values that transcend self-interest.`,
                'F': `The feeling type experiences life through empathy, values, and emotional resonance. Meaning is realized when compassion transforms into deliberate action, allowing emotion to guide purposeful engagement, and ensuring that care for others coexists with responsibility to self and life.`,
                'J': `The judging orientation seeks structure, order, and decisive action. Yet control is not purpose. True meaning arises when disciplined decisions serve a higher calling, allowing judgment to become an instrument for responsible living rather than an escape from uncertainty.`,
                'P': `The perceiving type values openness, flexibility, and responsiveness to life’s unfolding. Meaning is not found in freedom alone but in conscious engagement—choosing how to respond, embracing opportunity responsibly, and allowing curiosity to become directed action in service of life’s purpose.`
            };

            const personalityDescriptions = {
                'ISTJ': `Order brings safety. The ISTJ moves through life with steady hands and quiet conviction, upholding what is proven and true. Responsibility is their silent creed. Yet, beneath their reliability, there often lies an unspoken yearning—to be valued not only for their dependability, but for the tenderness they rarely allow the world to see.`,
                'ISFJ': `The ISFJ gives with quiet devotion, creating sanctuary in a world that seldom pauses. Their strength hides in humility; their love, in service. They tend to others’ needs instinctively, often forgetting their own. Behind their care lies a soul that longs to be cared for with the same gentleness they so effortlessly extend.`,
                'INFJ': `INFJs perceive life through symbols and meanings others miss. Their intuition weaves threads of empathy into vision. They sense human pain as though it were their own, often sacrificing themselves in the process. Beneath their serene composure lies a deep ache—to reconcile their inner truth with a world that too often fears its depth.`,
                'INTJ': `INTJs see life as a system to be understood, a puzzle to be elegantly resolved. Their insight cuts through illusion to essence. Purpose fuels them, solitude restores them. Yet, behind their precision lies an unspoken tenderness—the wish that the world might value understanding not as control, but as love expressed through clarity.`,
                'ISTP': `The ISTP moves fluidly between logic and action. They learn by doing, finding truth in direct experience. Detached calm steadies them amid chaos. Yet the same self-reliance that grants mastery can conceal a hidden solitude—a quiet uncertainty about belonging in a world that prizes words more than the language of doing.`,
                'ISFP': `ISFPs live through feeling and sensation, attuned to beauty, authenticity, and the sacredness of the moment. They seek harmony, not attention. Their gentleness often masks profound courage—the courage to live truthfully, even when unseen. Beneath their calm artistry rests a silent question: can the world honor softness as strength?`,
                'INFP': `INFPs live guided by inner values, drawn to what could be rather than what is. They see beauty in imperfection, hope in despair. Yet their idealism can isolate them—when the outer world cannot match their inner vision. Still, within them burns the timeless faith that authenticity itself can heal what is broken.`,
                'INTP': `The INTP seeks truth beyond appearance, ideas beyond convention. Their mind is a restless explorer, weaving patterns of thought where others see chaos. Detached yet deeply curious, they love clarity more than comfort. And beneath that intellectual distance, there lives a quiet longing—to feel at home in a world that rarely feels logical.`,
                'ESTP': `ESTPs meet life head-on—fast, fearless, alive. The present moment is their arena, risk their language. They thrive on movement, challenge, and immediacy. Yet their confidence can mask a deeper vulnerability: the fear of stillness, where action gives way to self-reflection. Beneath the thrill lies a human heart longing simply to rest.`,
                'ESFP': `ESFPs radiate vitality, sensing life through color, laughter, and touch. They live for connection, sharing energy like sunlight. Their spontaneity is medicine for the weary. Yet when the lights dim, they may feel the quiet ache of invisibility—the longing to be cherished not for their brightness, but for their unguarded truth.`,
                'ENFP': `ENFPs are guided by vision and possibility, moved by causes that ignite their hearts. They love deeply, dream vividly, and rebel against conformity. Yet their passion can scatter, their fire dimmed by overwhelm. Beneath their enthusiasm lies a quiet yearning—to find grounding without losing the wonder that makes them who they are.`,
                'ENTP': `ENTPs thrive on challenge and change, sparking ideas that disrupt stagnation. Their intellect dances with paradox and possibility. They question not to dominate, but to awaken. Yet their brilliance can conceal loneliness—the pain of being understood only for their wit, not their warmth. Beneath the debate lies a heart craving genuine connection.`,
                'ESTJ': `The ESTJ finds security in structure and progress in order. They lead by clarity, protect by discipline. Reliability is their language of love. Yet, in their pursuit of control, they may forget the gentleness that nurtures trust. Beneath the surface of certainty, there often lives a child yearning simply to be accepted without achievement.`,
                'ESFJ': `ESFJs create belonging wherever they go. Attuned to harmony, they nurture connection through care, tradition, and consistency. Their giving is sincere, yet exhausting when unreciprocated. Beneath their composure lies an unspoken plea—to be loved not only for their helpfulness, but for the quiet, unguarded self they so rarely reveal.`,
                'ENFJ': `ENFJs sense emotion like weather, responding with instinctive empathy. They uplift others through warmth and vision. Their gift is connection; their wound, self-neglect. In their quest to inspire, they may lose touch with their own needs. Yet when they remember to include themselves in their compassion, they become healers in motion.`,
                'ENTJ': `ENTJs lead with purpose and precision, turning ideas into structure and vision into strategy. They see potential where others see limits. Yet their drive can isolate them—control masking vulnerability, ambition hiding tenderness. When they allow softness alongside strength, they reveal not dominance, but deep devotion to creating a world that works.`
            };
            
            // --- NEW: Data for the profile grid ---
            const profileGridData = [
                { type: 'ISTJ', title: "Life's Natural Organizers", color: 'a' },
                { type: 'ISFJ', title: "Committed to Getting the Job Done", color: 'b' },
                { type: 'INFJ', title: "An Inspiring Leader and Follower", color: 'a' },
                { type: 'INTJ', title: "Life's Independent Thinkers", color: 'b' },

                { type: 'ISTP', title: "Just Do It", color: 'b' },
                { type: 'ISFP', title: "Action Speaks Louder Than Words", color: 'a' },
                { type: 'INFP', title: "Making Life Kinder and Gentler", color: 'b' },
                { type: 'INTP', title: "Life's Problem Solvers", color: 'a' },

                { type: 'ESTP', title: "Making the Most of the Moment", color: 'a' },
                { type: 'ESFP', title: "Let's Make Work Fun", color: 'b' },
                { type: 'ENFP', title: "People Are the Product", color: 'a' },
                { type: 'ENTP', title: "Progress Is the Product", color: 'b' },

                { type: 'ESTJ', title: "Life's Natural Administrators", color: 'b' },
                { type: 'ESFJ', title: "Everyone's Trusted Friend", color: 'a' },
                { type: 'ENFJ', title: "Smooth-Talking Persuaders", color: 'b' },
                { type: 'ENTJ', title: "Life's Natural Leaders", color: 'a' },
            ];

            // --- App State ---
            let currentQuestionIndex = 0;
            let userAnswers = new Array(questions.length).fill(null);
            let resultsChartInstance = null;
            let isAdvancing = false; 

            // --- DOM Elements ---
            const coverPage = document.getElementById('coverPage');
            const startBtn = document.getElementById('startBtn');
            const quizSection = document.getElementById('quizSection');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');
            const resultsPage = document.getElementById('resultsPage');
            const restartBtn = document.getElementById('restartBtn');
            const randomBtn = document.getElementById('randomBtn'); 
            const personalityTypeEl = document.getElementById('personalityType'); 
            const personalityWordsEl = document.getElementById('personalityWords'); 
            const qContainer = document.getElementById('q-container');
            const qNumber = document.getElementById('q-number');
            const qText = document.getElementById('q-text');
            const qOption0 = document.getElementById('q-option-0');
            const qOption1 = document.getElementById('q-option-1');
            const qLabel0 = document.getElementById('q-label-0');
            const qLabel1 = document.getElementById('q-label-1');
            const qRadio0 = document.getElementById('option0'); 
            const qRadio1 = document.getElementById('option1'); 

            // --- NEW: Modal and Grid DOM Elements ---
            const profileGrid = document.getElementById('profileGrid');
            const profileModal = document.getElementById('profileModal');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalDescription = document.getElementById('modalDescription');

            // --- Functions ---

            // --- NEW: Function to populate the 16-profile grid ---
            function populateProfileGrid() {
                if (!profileGrid) return;
                profileGrid.innerHTML = ''; // Clear existing
                
                profileGridData.forEach(profile => {
                    const cell = document.createElement('div');
                    cell.className = 'profile-cell ' + (profile.color === 'a' ? 'cell-color-a' : 'cell-color-b');
                    cell.dataset.type = profile.type;
                    
                    cell.innerHTML = `
                        <div class="profile-cell-type">${profile.type}</div>
                        <div class="profile-cell-title">${profile.title}</div>
                    `;
                    
                    profileGrid.appendChild(cell);
                });
            }

            // --- NEW: Functions to show/hide the profile modal ---
            function showProfileModal(type) {
                const profileData = profileGridData.find(p => p.type === type);
                const description = personalityDescriptions[type];

                if (!profileData || !description) {
                    console.error('Could not find data for type:', type);
                    return;
                }

                modalTitle.textContent = type;
                modalSubtitle.textContent = profileData.title;
                modalDescription.textContent = description;
                
                profileModal.style.display = 'flex';
            }

            function hideProfileModal() {
                profileModal.style.display = 'none';
            }
            // --- END NEW ---


            function showQuestion(isInitial = false) {
                const question = questions[currentQuestionIndex];
                const [letter1_raw, letter2_raw] = question.type.split('/');
                const letter1 = letter1_raw.trim();
                const letter2 = letter2_raw.trim();

                const transitionTime = isInitial ? 0 : 200; 

                if (!isInitial) {
                    qContainer.classList.add('transitioning');
                }

                setTimeout(() => {
                    qNumber.textContent = currentQuestionIndex + 1;
                    qText.textContent = question.text;
                    
                    qLabel0.textContent = question.options[0];
                    qOption0.dataset.value = letter1;
                    qRadio0.value = letter1;

                    qLabel1.textContent = question.options[1];
                    qOption1.dataset.value = letter2;
                    qRadio1.value = letter2;

                    qOption0.classList.remove('selected');
                    qOption1.classList.remove('selected');
                    qRadio0.checked = false;
                    qRadio1.checked = false;

                    const previousAnswer = userAnswers[currentQuestionIndex];
                    if (previousAnswer) {
                        if (previousAnswer === letter1) {
                            qOption0.classList.add('selected');
                            qRadio0.checked = true;
                        } else if (previousAnswer === letter2) {
                            qOption1.classList.add('selected');
                            qRadio1.checked = true;
                        }
                    }

                    updateNavigation();

                    if (!isInitial) {
                        qContainer.style.transform = 'translateY(10px)';
                        qContainer.style.transition = 'none'; 
                        void qContainer.offsetHeight; 
                        qContainer.style.transition = 'opacity 0.2s ease-in-out, transform 0.2s ease-in-out';
                        qContainer.style.transform = 'translateY(0)';
                        qContainer.classList.remove('transitioning'); 
                    } else {
                        qContainer.style.opacity = 1; 
                    }
                    
                    isAdvancing = false;

                }, transitionTime);
            }

            function handleOptionClick(optionEl) {
                if (isAdvancing) return; 
                isAdvancing = true; 

                const selectedValue = optionEl.dataset.value;
                userAnswers[currentQuestionIndex] = selectedValue;

                qOption0.classList.remove('selected');
                qOption1.classList.remove('selected');
                optionEl.classList.add('selected');
                
                if (optionEl === qOption0) {
                    qRadio0.checked = true;
                } else {
                    qRadio1.checked = true;
                }

                setTimeout(() => {
                    if (currentQuestionIndex < questions.length - 1) {
                        currentQuestionIndex++;
                        showQuestion(); 
                    } else {
                        updateNavigation();
                        isAdvancing = false; 
                    }
                }, 200); 
            }

            function updateNavigation() {
                prevBtn.disabled = currentQuestionIndex === 0;
                nextBtn.style.display = 'none'; 
                
                if (currentQuestionIndex === questions.length - 1) {
                    finishBtn.style.display = 'inline-block';
                    const allAnswered = userAnswers.every(answer => answer !== null);
                    finishBtn.disabled = !allAnswered;
                } else {
                    finishBtn.style.display = 'none';
                }
            }

            function showResults() {
                quizSection.style.display = 'none';
                resultsPage.style.display = 'block';

                const scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                userAnswers.forEach(answer => {
                    if (answer) {
                        scores[answer]++;
                    }
                });

                scores.E *= 2;
                scores.I *= 2;
                
                // --- NEW: Define max scores for percentage calculation ---
                const maxScores = { E: 22, I: 22, S: 23, N: 23, T: 23, F: 23, J: 23, P: 23 };

                const colorMap = {
                    'E': { bg: 'rgba(68, 179, 225, 0.9)', border: 'rgba(68, 179, 225, 1)' },
                    'I': { bg: 'rgba(234, 228, 0, 0.9)', border: 'rgba(234, 228, 0, 1)' },
                    'S': { bg: 'rgba(255, 153, 0, 0.9)', border: 'rgba(255, 153, 0, 1)' },
                    'N': { bg: 'rgba(120, 33, 112, 0.9)', border: 'rgba(120, 33, 112, 1)' },
                    'T': { bg: 'rgba(33, 92, 152, 0.9)', border: 'rgba(33, 92, 152, 1)' },
                    'F': { bg: 'rgba(78, 167, 46, 0.9)', border: 'rgba(78, 167, 46, 1)' },
                    'J': { bg: 'rgba(235, 21, 21, 0.9)', border: 'rgba(235, 21, 21, 1)' },
                    'P': { bg: 'rgba(153, 102, 51, 0.9)', border: 'rgba(153, 102, 51, 1)' }
                };

                const finalData = [];
                const otherLetters = []; 
                let realScore, maxScore, percentage; // --- MODIFIED ---

                if (scores.E >= scores.I) {
                    realScore = scores.E;
                    maxScore = maxScores.E; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'E', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('I'); 
                } else {
                    realScore = scores.I;
                    maxScore = maxScores.I; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'I', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('E'); 
                }

                if (scores.S >= scores.N) {
                    realScore = scores.S;
                    maxScore = maxScores.S; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'S', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('N'); 
                } else {
                    realScore = scores.N;
                    maxScore = maxScores.N; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'N', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('S'); 
                }

                if (scores.T >= scores.F) {
                    realScore = scores.T;
                    maxScore = maxScores.T; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'T', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('F'); 
                } else {
                    realScore = scores.F;
                    maxScore = maxScores.F; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'F', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('T'); 
                }

                if (scores.J >= scores.P) {
                    realScore = scores.J;
                    maxScore = maxScores.J; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'J', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('P'); 
                } else {
                    realScore = scores.P;
                    maxScore = maxScores.P; // --- NEW ---
                    percentage = (realScore / maxScore) * 100; // --- NEW ---
                    finalData.push({ letter: 'P', score: percentage, realScore: realScore, maxScore: maxScore }); // --- MODIFIED ---
                    otherLetters.push('J'); 
                }
                
                const chartLabels = finalData.map(d => d.letter);
                const chartData = finalData.map(d => d.score); // This is now percentage
                const chartRealScores = finalData.map(d => d.realScore); 
                const chartMaxScores = finalData.map(d => d.maxScore); // --- NEW ---
                const chartBackgroundColors = finalData.map(d => colorMap[d.letter].bg);
                const chartBorderColors = finalData.map(d => colorMap[d.letter].border);

                const personalityTypeString = chartLabels.join('');
                
                // --- NEW: Highlight the result in the profile grid ---
                // First, clear any existing highlights
                document.querySelectorAll('.profile-cell.highlight').forEach(cell => {
                    cell.classList.remove('highlight');
                });
                
                // Then, add the highlight to the matching cell
                const resultCell = document.querySelector(`.profile-cell[data-type="${personalityTypeString}"]`);
                if (resultCell) {
                    resultCell.classList.add('highlight');
                }
                // --- END NEW ---
                
                const oppositeTypeString = otherLetters.join('');
                
                const personalityWordsArray = chartLabels.map(letter => {
                    const fullWord = wordMap[letter]; 
                    const keyIndex = fullWord.toLowerCase().indexOf(letter.toLowerCase());
                    if (keyIndex === -1) { return fullWord; }
                    const before = fullWord.substring(0, keyIndex); 
                    const keyChar = fullWord.substring(keyIndex, keyIndex + 1); 
                    const after = fullWord.substring(keyIndex + 1); 
                    return `${before}<strong>${keyChar}</strong>${after}`;
                });
                const personalityWordsHTML = personalityWordsArray.join(' - ');

                if (personalityTypeEl) {
                    personalityTypeEl.textContent = personalityTypeString;
                }
                if (personalityWordsEl) {
                    personalityWordsEl.innerHTML = personalityWordsHTML; 
                }

                const oppositeHeaderEl = document.getElementById('oppositeTypeHeader');
                if (oppositeHeaderEl) {
                    oppositeHeaderEl.textContent = `Your converse profile: ${oppositeTypeString}`; 
                }

                const letterGrid = document.getElementById('letter-grid');
                if (chartLabels.length === 4) {
                    letterGrid.style.display = 'grid'; 
                    for (let i = 0; i < 4; i++) {
                        const letter = chartLabels[i];
                        const fullWord = wordMap[letter];
                        const description = letterDescriptions[letter];
                        const color = colorMap[letter].border; 
                        const bgColor = color.replace(', 1)', ', 0.1)');

                        const cardElement = document.getElementById(`letter-card-${i}`); 
                        
                        cardElement.style.borderColor = color;
                        cardElement.style.backgroundColor = bgColor; 

                        document.getElementById(`letter-title-${i}`).textContent = fullWord;
                        document.getElementById(`letter-desc-${i}`).textContent = description;
                    }
                } else {
                    letterGrid.style.display = 'none'; 
                }

                const otherLetterGrid = document.getElementById('other-letter-grid');
                if (otherLetters.length === 4) {
                    for (let i = 0; i < 4; i++) {
                        const letter = otherLetters[i];
                        const fullWord = wordMap[letter];
                        const description = letterDescriptions[letter];
                        const color = colorMap[letter].border;

                        const cardElement = document.getElementById(`other-letter-card-${i}`);
                        
                        cardElement.style.borderColor = color;
                        document.getElementById(`other-letter-title-${i}`).textContent = fullWord;
                        document.getElementById(`other-letter-desc-${i}`).textContent = description;
                    }
                }

                const description = personalityDescriptions[personalityTypeString] || "Your personality description will appear here.";
                document.getElementById('desc-overview').textContent = description;
                
                const ctx = document.getElementById('resultsChart').getContext('2d');

                if (resultsChartInstance) {
                    resultsChartInstance.destroy();
                }

                resultsChartInstance = new Chart(ctx, {
                    type: 'bar', 
                    data: {
                        labels: chartLabels, 
                        datasets: [
                            {
                                label: 'Score',
                                data: chartData, 
                                realScores: chartRealScores, 
                                maxScores: chartMaxScores, // --- NEW ---
                                backgroundColor: chartBackgroundColors,
                                borderColor: chartBorderColors,
                                borderWidth: 1,
                                borderRadius: 5,
                                borderSkipped: false,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false 
                            },
                            tooltip: {
                                callbacks: {
                                    // --- MODIFIED: Tooltip to show % and raw score ---
                                    label: function(context) {
                                        const label = context.label || '';
                                        const realScore = context.dataset.realScores[context.dataIndex];
                                        const maxScore = context.dataset.maxScores[context.dataIndex];
                                        const percentage = context.dataset.data[context.dataIndex];
                                        
                                        if (label) {
                                            return `${label}: ${percentage.toFixed(1)}% (${realScore}/${maxScore})`;
                                        }
                                        return `${percentage.toFixed(1)}%`;
                                    }
                                    // --- END MODIFIED ---
                                }
                            }
                        },
                        scales: {
                            x: { 
                                grid: {
                                    display: false, 
                                    borderColor: '#ccc'
                                },
                                ticks: {
                                    font: {
                                        family: 'Poppins',
                                        size: 14,
                                        weight: '600'
                                    },
                                    color: '#2c3e50'
                                }
                            },
                            y: { 
                                beginAtZero: true,
                                max: 100, // --- MODIFIED: Set max to 100% ---
                                grid: {
                                    color: '#e0e6ed', 
                                    borderColor: '#ccc'
                                },
                                ticks: {
                                    // --- NEW: Add '%' suffix to Y-axis labels ---
                                    callback: function(value) {
                                        return value + '%';
                                    },
                                    // --- END NEW ---
                                    font: {
                                        family: 'Poppins'
                                    },
                                    color: '#333'
                                }
                            }
                        }
                    }
                });
            }
            
            function restartQuiz() {
                currentQuestionIndex = 0;
                userAnswers.fill(null);
                
                resultsPage.style.display = 'none';
                quizSection.style.display = 'none'; 
                coverPage.style.display = 'flex'; 

                if (resultsChartInstance) {
                    resultsChartInstance.destroy();
                    resultsChartInstance = null;
                }
                
                if (personalityTypeEl) {
                    personalityTypeEl.textContent = '';
                }
                if (personalityWordsEl) {
                    personalityWordsEl.innerHTML = ''; 
                }

                document.getElementById('letter-grid').style.display = 'none';
                document.querySelectorAll('.result-section').forEach((detail, index) => {
                    detail.open = false;
                });
                document.querySelectorAll('.letter-card').forEach(detail => {
                    detail.open = false;
                    detail.style.borderColor = '';
                    detail.style.backgroundColor = '';
                });
                
                const otherGrid = document.getElementById('other-letter-grid');
                const otherBtn = document.getElementById('showOtherBtn');
                const oppositeHeaderEl = document.getElementById('oppositeTypeHeader'); 
                
                if (otherGrid) otherGrid.style.display = 'none';
                if (otherBtn) otherBtn.textContent = 'Show Converse Profile'; 
                if (oppositeHeaderEl) oppositeHeaderEl.style.display = 'none'; 

                document.querySelectorAll('.other-letter-card').forEach(detail => {
                    detail.open = false;
                    detail.style.borderColor = '';
                });

                // --- NEW: Clear profile grid highlight ---
                const highlightedCell = document.querySelector('.profile-cell.highlight');
                if (highlightedCell) {
                    highlightedCell.classList.remove('highlight');
                }
                // --- END NEW ---

                hideProfileModal(); // NEW: Hide modal on restart
            }

            function generateRandomResults() {
                if (isAdvancing) return; 
                
                coverPage.style.display = 'none'; 
                quizSection.style.display = 'block'; 

                userAnswers = questions.map(q => {
                    if (typeof q.type !== 'string' || !q.type.includes('/')) {
                        console.error('Invalid question type:', q);
                        return null; 
                    }
                    const [letter1_raw, letter2_raw] = q.type.split('/');
                    const letter1 = letter1_raw.trim();
                    const letter2 = letter2_raw.trim();
                    return Math.random() < 0.5 ? letter1 : letter2;
                });

                showResults(); 
            }


            // --- Event Listeners ---
            startBtn.addEventListener('click', () => { 
                if (isAdvancing) return; 
                isAdvancing = true;     
                coverPage.style.display = 'none'; 
                quizSection.style.display = 'block'; 
                document.body.style.overflow = 'auto'; 
                showQuestion(true); 
            });

            prevBtn.addEventListener('click', () => {
                if (isAdvancing) return; 
                isAdvancing = true; 
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    showQuestion();
                } else {
                    isAdvancing = false; 
                }
            });
            
            nextBtn.addEventListener('click', () => {
                if (isAdvancing) return; 
                isAdvancing = true; 
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion();
                } else {
                    isAdvancing = false; 
                }
            });
            
            finishBtn.addEventListener('click', () => {
                if (isAdvancing) return; 
                showResults();
            });
            
            restartBtn.addEventListener('click', restartQuiz);
            randomBtn.addEventListener('click', generateRandomResults); 
            qOption0.addEventListener('click', () => handleOptionClick(qOption0));
            qOption1.addEventListener('click', () => handleOptionClick(qOption1));

            // --- Toggle "Other Perspectives" logic ---
            const showOtherBtn = document.getElementById('showOtherBtn');
            const otherLetterGrid = document.getElementById('other-letter-grid');
            const oppositeHeaderEl = document.getElementById('oppositeTypeHeader');

            if (showOtherBtn && otherLetterGrid && oppositeHeaderEl) { 
                showOtherBtn.addEventListener('click', () => {
                    const isHidden = otherLetterGrid.style.display === 'none' || otherLetterGrid.style.display === '';
                    if (isHidden) {
                        otherLetterGrid.style.display = 'grid';
                        oppositeHeaderEl.style.display = 'block'; 
                        showOtherBtn.textContent = 'Hide Converse Profile'; 
                    } else {
                        otherLetterGrid.style.display = 'none';
                        oppositeHeaderEl.style.display = 'none'; 
                        showOtherBtn.textContent = 'Show Converse Profile'; 
                    }
                });
            }

            // --- NEW: Grid and Modal Event Listeners ---
            populateProfileGrid(); // Call the function to build the grid

            if (profileGrid) {
                profileGrid.addEventListener('click', (e) => {
                    const cell = e.target.closest('.profile-cell');
                    if (cell && cell.dataset.type) {
                        showProfileModal(cell.dataset.type);
                    }
                });
            }

            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', hideProfileModal);
            }

            if (profileModal) {
                profileModal.addEventListener('click', (e) => {
                    // Close if clicking on the overlay (e.target), but not the content
                    if (e.target === profileModal) {
                        hideProfileModal();
                    }
                });
            }
            // --- END NEW ---
            
        }); 
    </script>

</body>
</html>





